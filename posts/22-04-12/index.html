<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>k8s原生CI/CD - chengleqi's blog</title><meta name=description content><meta property="og:title" content="k8s原生CI/CD"><meta property="og:description" content="狐狸、小狗和星际章鱼？"><meta property="og:type" content="article"><meta property="og:url" content="https://chengleqi.com/posts/22-04-12/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-11T21:49:39+08:00"><meta property="article:modified_time" content="2022-04-11T21:49:39+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="k8s原生CI/CD"><meta name=twitter:description content="狐狸、小狗和星际章鱼？"><meta name=application-name content="chengleqi's blog"><meta name=apple-mobile-web-app-title content="chengleqi's blog"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://chengleqi.com/posts/22-04-12/><link rel=prev href=https://chengleqi.com/posts/22-04-11/><link rel=next href=https://chengleqi.com/posts/22-04-18/><link rel=stylesheet href=/css/page.min.css><link rel=stylesheet href=/css/home.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"k8s原生CI/CD","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/chengleqi.com\/posts\/22-04-12\/"},"genre":"posts","keywords":"CI\/CD","wordcount":382,"url":"https:\/\/chengleqi.com\/posts\/22-04-12\/","datePublished":"2022-04-11T21:49:39+08:00","dateModified":"2022-04-11T21:49:39+08:00","publisher":{"@type":"Organization","name":"chengleqi"},"author":{"@type":"Person","name":"chengleqi"},"description":""}</script></head><body data-header-desktop data-header-mobile><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":''==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:''==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="chengleqi's blog">0x6B0873</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/chengleqi/chengleqi.github.io rel="noopener noreffer" target=_blank><i class="fab fa-github"></i> </a><a class=menu-item href=https://hub.docker.com/u/chengleqi rel="noopener noreffer" target=_blank><i class="fab fa-docker"></i> </a><a class=menu-item href=https://chengleqi.notion.site/Kubernetes-in-Action-b2706120ab174888817b1aa454cc8785 rel="noopener noreffer" target=_blank><i class="fas fa-spin fa-dharmachakra"></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=# class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a class=menu-item href=/index.xml title=RSS><i class="fas fa-rss fa-fw" title=RSS></i> </a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="chengleqi's blog">0x6B0873</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=# class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=# class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/about/ title>关于</a><a class=menu-item href=https://github.com/chengleqi/chengleqi.github.io title rel="noopener noreffer" target=_blank><i class="fab fa-github"></i></a><a class=menu-item href=https://hub.docker.com/u/chengleqi title rel="noopener noreffer" target=_blank><i class="fab fa-docker"></i></a><a class=menu-item href=https://chengleqi.notion.site/Kubernetes-in-Action-b2706120ab174888817b1aa454cc8785 title rel="noopener noreffer" target=_blank><i class="fas fa-spin fa-dharmachakra"></i></a><div class=menu-item><a href=/index.xml title=RSS><i class="fas fa-rss fa-fw" title=RSS></i></a>
<span>&nbsp;|&nbsp;</span><a href=javascript:void(0); class=theme-switch title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single" data-toc=disable><div class=single-card><h2 class="single-title animated flipInX">k8s原生CI/CD</h2><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>chengleqi</a></span>&nbsp;<span class=post-category>出版于 <a href=/categories/kubernetes/><i class="far fa-folder fa-fw"></i>Kubernetes</a></span></div><div class=post-meta-line><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-04-11>2022-04-11</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 382 字</span>&nbsp;
<span><i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 1 分钟</span>&nbsp;</div></div><hr><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#tekton>Tekton</a><ul><li><a href=#基本概念>基本概念</a></li><li><a href=#tekton如何保证pod内的容器执行顺序>Tekton如何保证Pod内的容器执行顺序？</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>狐狸、小狗和星际章鱼？</p><h2 id=tekton>Tekton</h2><h3 id=基本概念>基本概念</h3><ul><li>A <strong>step</strong> is an operation in a CI/CD workflow &ndash;> Tekton performs each step with a container image you provide.</li><li>A <strong>task</strong> is a collection of steps in order &ndash;> Tekton runs a task in the form of a Kubernetes pod, where each step becomes a running container in the pod. This design allows you to set up a shared environment for a number of related steps.</li><li>A <strong>pipeline</strong> is a collection of tasks in order.</li><li><strong>TaskRuns</strong> and <strong>pipelineRuns</strong> connect resources with tasks and pipelines. A run must include the actual addresses of resources, such as the URLs of repositories, its task or pipeline needs. This design allows developers to reuse tasks and pipelines for different inputs and outputs.<figure><a class=lightgallery href=https://chengleqi-blog-image.oss-cn-hangzhou.aliyuncs.com/img/202205061055809.png title=https://chengleqi-blog-image.oss-cn-hangzhou.aliyuncs.com/img/202205061055809.png data-thumbnail=https://chengleqi-blog-image.oss-cn-hangzhou.aliyuncs.com/img/202205061055809.png data-sub-html="<h2>Step Task Pipeline</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=https://chengleqi-blog-image.oss-cn-hangzhou.aliyuncs.com/img/202205061055809.png data-srcset="https://chengleqi-blog-image.oss-cn-hangzhou.aliyuncs.com/img/202205061055809.png, https://chengleqi-blog-image.oss-cn-hangzhou.aliyuncs.com/img/202205061055809.png 1.5x, https://chengleqi-blog-image.oss-cn-hangzhou.aliyuncs.com/img/202205061055809.png 2x" data-sizes=auto alt=https://chengleqi-blog-image.oss-cn-hangzhou.aliyuncs.com/img/202205061055809.png width=700px></a><figcaption class=image-caption>Step Task Pipeline</figcaption></figure></li></ul><h3 id=tekton如何保证pod内的容器执行顺序>Tekton如何保证Pod内的容器执行顺序？</h3><p>Tekton通过注入一个叫<a href=https://github.com/tektoncd/pipeline/tree/main/cmd/entrypoint target=_blank rel="noopener noreffer"><strong>entrypoint</strong></a>的二进制文件来确保容器的执行顺序，对应的也就是Step的执行顺序。</p><div class="details admonition quote open"><div class="details-summary admonition-title"><i class="icon fas fa-quote-right fa-fw"></i>How Tekton works<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>Tekton Pipelines tracks the state of your pipeline using Kubernetes Annotations. These annotations are projected inside each step container in the form of files with the Kubernetes Downward API. The entrypoint binary watches the projected files closely, and will only start the provided command if a specific annotation appears as files. For example, when you ask Tekton to run two steps consecutively in a task, the entrypoint binary injected into the second step container will wait idly until the annotations report that the first step container has successfully completed.</div></div></div><p><a href=https://kubernetes.io/zh/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#%E5%AD%98%E5%82%A8-pod-%E5%AD%97%E6%AE%B5 target=_blank rel="noopener noreffer">Kubernetes Downward API</a>能将Pod的注解投影至Container的卷中，entrypoint就可以通过文件的状态和内容监控前一个Container执行情况。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-tag><span><a href=/tags/ci/cd/>CI/CD</a></span></div><div class=post-info-line><div class=post-info-mod><span>更新于 2022-04-11</span></div><div class=post-info-mod></div></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://chengleqi.com/posts/22-04-12/ data-title=k8s原生CI/CD data-via=star_wild_src data-hashtags=CI/CD><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://chengleqi.com/posts/22-04-12/ data-hashtag=CI/CD><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://chengleqi.com/posts/22-04-12/ data-title=k8s原生CI/CD><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://chengleqi.com/posts/22-04-12/ data-title=k8s原生CI/CD><i class="fab fa-evernote fa-fw"></i></a></span></div></div><div class=post-nav><a href=/posts/22-04-11/ class=prev rel=prev title=Knative简记><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
<a href=/posts/22-04-18/ class=next rel=next title=集群联邦和Karmada>Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div></div><div id=comments class=single-card><div id=vssue></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://github.com/meteorlxy/vssue>Vssue</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.98.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/khusika/FeelIt target=_blank rel="noopener noreffer" title="FeelIt 1.0.1"><i class="fas fa-hand-holding-heart fa-fw"></i> FeelIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/>chengleqi</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-chevron-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment-alt fa-fw"></i></a></div><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><link rel=stylesheet href=/lib/vue/vssue/vssue.min.css><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script src=/lib/vue/vue.runtime.js></script><script src=/lib/vue/vssue/vssue.github.min.js></script><script src=/lib/autocomplete/autocomplete.min.js></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script src=/lib/lazysizes/lazysizes.min.js></script><script src=/lib/twemoji/twemoji.min.js></script><script src=/lib/lightgallery/lightgallery.min.js></script><script src=/lib/lightgallery/lg-thumbnail.min.js></script><script src=/lib/lightgallery/lg-zoom.min.js></script><script src=/lib/clipboard/clipboard.min.js></script><script src=/lib/sharer/sharer.min.js></script><script>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{vssue:{clientID:"7e0e077deba6c51540c9",clientSecret:"02cc5e3df375e4da463c2137eed0ad7af6235272",owner:"chengleqi",repo:"vssue-comment",title:"k8s原生CI/CD"}},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{algoliaAppID:"UEHJYEAUS7",algoliaIndex:"chengleqi-blog",algoliaSearchKey:"e4d8a33fb70564ca5dc114905aaeef08",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"algolia"},twemoji:!0}</script><script src=/js/theme.min.js></script></body></html>