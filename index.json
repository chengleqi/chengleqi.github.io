[{"categories":["Chaos Engineering"],"content":"çœŸå®çš„å°±æ˜¯æ··æ²Œçš„. ","date":"2022-05-04","objectID":"/posts/22-05-03/:0:0","tags":["Chaos Mesh","Litmus"],"title":"æœ‰æ„æ€çš„æ··æ²Œå·¥ç¨‹","uri":"/posts/22-05-03/"},{"categories":["Ingress"],"content":"è‡ªåŠ¨æ£€æµ‹å’Œçƒ­æ›´æ–°ï¼ ","date":"2022-05-04","objectID":"/posts/22-05-04/:0:0","tags":["Traefik","Cert-Manager"],"title":"äº‘åŸç”Ÿä»£ç†Traefik","uri":"/posts/22-05-04/"},{"categories":["IaC"],"content":"åœ¨k8sä¸­ç®¡ç†ä½ çš„åŸºç¡€è®¾æ–½ğŸ˜‹ğŸ¦! ã€ŠWhat is Infrastructure as Code (IaC)?ã€‹by RedHat Infrastructure as Code (IaC) is the managing and provisioning of infrastructure through code instead of through manual processes. With IaC, configuration files are created that contain your infrastructure specifications, which makes it easier to edit and distribute configurations. It also ensures that you provision the same environment every time. By codifying and documenting your configuration specifications, IaC aids configuration management and helps you to avoid undocumented, ad-hoc configuration changes. Version control is an important part of IaC, and your configuration files should be under source control just like any other software source code file. Deploying your infrastructure as code also means that you can divide your infrastructure into modular components that can then be combined in different ways through automation. Automating infrastructure provisioning with IaC means that developers donâ€™t need to manually provision and manage servers, operating systems, storage, and other infrastructure components each time they develop or deploy an application. Codifying your infrastructure gives you a template to follow for provisioning, and although this can still be accomplished manually, an automation tool, such as Red HatÂ® Ansible AutomationÂ® Platform, can do it for you. ","date":"2022-05-02","objectID":"/posts/22-05-02/:0:0","tags":["Terraform","Crossplane"],"title":"IaC: ä»Terraformåˆ°Crossplane","uri":"/posts/22-05-02/"},{"categories":["Kubernetes"],"content":"æ˜Ÿé™…å°ºåº¦ï¼Ÿ ","date":"2022-04-18","objectID":"/posts/22-04-18/:0:0","tags":["Cluster Federation"],"title":"é›†ç¾¤è”é‚¦å’ŒKarmada","uri":"/posts/22-04-18/"},{"categories":["Kubernetes"],"content":"ç‹ç‹¸ã€å°ç‹—å’Œæ˜Ÿé™…ç« é±¼ï¼Ÿ ","date":"2022-04-11","objectID":"/posts/22-04-12/:0:0","tags":["CI/CD"],"title":"k8såŸç”ŸCI/CD","uri":"/posts/22-04-12/"},{"categories":["Serverless"],"content":"æœåŠ¡ç«¯çš„ç»ˆæï¼Ÿ ","date":"2022-04-11","objectID":"/posts/22-04-11/:0:0","tags":["Knative"],"title":"Knativeç®€è®°","uri":"/posts/22-04-11/"},{"categories":["Kubernetes"],"content":"Kubernetes the hard way ğŸ¥² why is k8s so fucking complex?\" why is k8s so fucking complex? ","date":"2022-04-05","objectID":"/posts/22-04-05/:0:0","tags":["Golang"],"title":"k8sä¸­çš„è¯ä¹¦æœºåˆ¶å’Œè¿œç¨‹è°ƒè¯•","uri":"/posts/22-04-05/"},{"categories":["Kubernetes"],"content":"ä¸€åˆ‡éƒ½æ˜¯ä¸ºäº†é€šï¼ â€”â€”é˜…è¯»ã€Šæ·±å…¥å‰–æKubernetesã€‹ç¬¬7ç« æœ‰æ„Ÿ ä¸ºäº†èšåˆç®—åŠ›ï¼Œä¸ºäº†å±è”½åŸºç¡€è®¾æ–½çš„å·®å¼‚ï¼Œè¦è®©Podç›¸äº’è¿é€šæ˜¯é‡å¤§ä¸”ç°å®çš„é—®é¢˜ã€‚ k8sä¸ºäº†è§£å†³Podé—´çš„ç½‘ç»œè¿é€šè®¾ç½®äº†CNIæ¥å£æ¥ä¾›å„æ–¹å®ç°ï¼Œè¿™æ ·å°±å¯ä»¥è§£è€¦ä¸æŸç§ç‰¹å®šç½‘ç»œæ–¹æ¡ˆä¹‹é—´çš„ç»‘å®šï¼Œç±»ä¼¼çš„è®¾è®¡æ€æƒ³åœ¨k8sä¸Šè¿˜ä½“ç°åœ¨CRIå’ŒCSIæ¥å£çš„è®¾ç½®ä¸Šã€‚ç°åœ¨å·²ç»æœ‰è®¸å¤šå®ç°äº†CNIæ¥å£çš„æˆç†Ÿçš„ç½‘ç»œæ–¹æ¡ˆï¼Œæ¯”è¾ƒçŸ¥åçš„æœ‰flannelã€Calicoå’ŒCiliumã€‚ ","date":"2022-04-01","objectID":"/posts/22-04-01/:0:0","tags":["Network"],"title":"Kubernetesç½‘ç»œæ¨¡å‹","uri":"/posts/22-04-01/"},{"categories":["Kubernetes"],"content":"å•æœºå®¹å™¨äº’è” Dockerå®¹å™¨ç½‘ç»œæœ‰å››ç§æ¨¡å¼ï¼Œhostã€noneã€bridgeå’Œcontainerï¼Œåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šä»¥å“ªç§æ–¹å¼è®¾ç½®ç½‘ç»œï¼Œä¸æŒ‡å®šçš„è¯é»˜è®¤æ˜¯æ¡¥æ¥ã€‚ åœ¨é»˜è®¤æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªå®¹å™¨éƒ½åœ¨ä¸€ä¸ªNetwork Namespaceä¸­å¹¶ä¸”æœ‰ä¸€å¼ vethç½‘å¡æ’åœ¨docker0è™šæ‹Ÿäº¤æ¢æœºä¸Šï¼Œå®¹å™¨ä¹‹é—´çš„ç›¸äº’é€šä¿¡æ˜¯é€šè¿‡äº¤æ¢æœºå¹¿æ’­ARPåœ¨äºŒå±‚å®ç°çš„ï¼Œå®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡è®¾ç½®å®¹å™¨çš„è·¯ç”±è¡¨æ‰¾åˆ°æ’åœ¨å®¿ä¸»æœºä¸Šçš„ä¸docker0ç½‘æ¡¥åŒåçš„docker0ç½‘å¡å®ç°çš„ã€‚ç½‘ç»œæµé‡å¯ä»¥é€šè¿‡tcpdumpæŒ‡å®šç½‘å¡æŠ“åŒ…æŸ¥çœ‹ï¼Œç½‘æ¡¥è®¾å¤‡ä¹Ÿå¯ä»¥é€šè¿‡brctlæŸ¥çœ‹ï¼Œå¹¶ä¸”å¯ä»¥æŸ¥çœ‹æ’åœ¨è™šæ‹Ÿç½‘æ¡¥ä¸Šçš„veth pairè®¾å¤‡ã€‚ æ¡¥æ¥æ¨¡å¼\" æ¡¥æ¥æ¨¡å¼ è¿™é‡Œæœ‰ä¸ªå°æŠ€å·§ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŸ¥çœ‹k8sé›†ç¾¤å†…DNSè¯·æ±‚çš„æƒ…å†µï¼Œä½†æ˜¯DNSå®¹å™¨å¾€å¾€ä¸å…·å¤‡bashï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡docker execçš„æ–¹å¼è¿›å…¥å®¹å™¨å†…æŠ“åŒ…ï¼Œè¿™æ—¶å¯ä»¥è¿›å…¥è¯¥å®¹å™¨çš„Network Namespaceï¼Œå†æŠ“åŒ…ã€‚ // 1ã€æ‰¾åˆ°CONTAINER_IDï¼Œå¹¶æ‰“å°å®ƒçš„NS_ID docker inspect --format \"{{.State.Pid}}\" $CONTAINER_ID // 2ã€è¿›å…¥è¯¥å®¹å™¨çš„Network Namespace nsenter -n -t $NS_ID // 3ã€æŠ“DNSåŒ… tcpdump -i eth0 udp dst port 53 ","date":"2022-04-01","objectID":"/posts/22-04-01/:1:0","tags":["Network"],"title":"Kubernetesç½‘ç»œæ¨¡å‹","uri":"/posts/22-04-01/"},{"categories":["Kubernetes"],"content":"å®¹å™¨è·¨ä¸»äº’è” ","date":"2022-04-01","objectID":"/posts/22-04-01/:2:0","tags":["Network"],"title":"Kubernetesç½‘ç»œæ¨¡å‹","uri":"/posts/22-04-01/"},{"categories":["Kubernetes"],"content":"flannel k8sç»å…¸çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆæ˜¯flannelã€‚ flannel backends Flannel may be paired with several different backends. Once set, the backend should not be changed at runtime. VXLAN is the recommended choice. host-gw is recommended for more experienced users who want the performance improvement and whose infrastructure support it (typically it canâ€™t be used in cloud environments). UDP is suggested for debugging only or for very old kernels that donâ€™t support VXLAN. VXLAN Use in-kernel VXLAN to encapsulate the packets. host-gw Use host-gw to create IP routes to subnets via remote machine IPs. Requires direct layer2 connectivity between hosts running flannel. host-gw provides good performance, with few dependencies, and easy set up. UDP Use UDP only for debugging if your network and kernel prevent you from using VXLAN or host-gw. flannelæœ‰ä¸‰ç§åç«¯å®ç°ï¼ŒUDPã€VXLANå’Œhost-gwï¼Œå…¶ä¸­UDPæ¨¡å¼å·²ç»åºŸå¼ƒï¼Œåªåœ¨è°ƒè¯•æˆ–è€…ç½‘ç»œå’Œå†…æ ¸ä¸æ”¯æŒä½¿ç”¨host-gwå’ŒVXLANæ¨¡å¼æ—¶å¯ä»¥é€‰æ‹©ä½¿ç”¨ã€‚ä½†æ˜¯UDPæ¨¡å¼ä¹Ÿæ˜¯æœ€å¥½ç†è§£çš„æ¨¡å¼ã€‚ UDP mode UDPæ¨¡å¼çš„æ ¸å¿ƒæ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºäº†flannel0ç½‘ç»œè®¾å¤‡å’Œflanneldå®ˆæŠ¤è¿›ç¨‹ï¼Œä¾é å°åŒ…å’Œè§£åŒ…è¿™ç§éš§é“æ¨¡å¼åœ¨èŠ‚ç‚¹ä¹‹é—´å»ºç«‹èµ·overlayç½‘ç»œã€‚ å½“æœ¬æœºçš„podæƒ³å‘é€è¯·æ±‚åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šçš„podæ—¶ï¼Œç”±äºç›®çš„åœ°å€ä¸åœ¨docker0ç½‘æ®µï¼Œæ‰€ä»¥ä¼šè¢«docker0ç½‘æ¡¥å‘é€è‡³å®¿ä¸»æœºçš„docker0ç½‘å¡ä¸Šï¼Œæ­¤æ—¶æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œç”±äºè·¯ç”±è¡¨è§„åˆ™å·²ç»è¢«flanneldæå‰å†™å…¥ï¼Œæ‰€ä»¥ä¼šè½¬å‘åˆ°ä¸€ä¸ªå«flannel0çš„ç½‘ç»œè®¾å¤‡ä¸Šï¼Œè¯¥è®¾å¤‡æ˜¯ä¸€ä¸ªTUNè®¾å¤‡ï¼Œè¿™ç§è®¾å¤‡ä¼šå°†å­˜åœ¨äºå†…æ ¸æ€ä¸­çš„ç½‘ç»œåŒ…è½¬å‘ç»™åˆ›å»ºè¯¥ç½‘ç»œè®¾å¤‡çš„ç”¨æˆ·æ€çš„è¿›ç¨‹ï¼Œåœ¨æ­¤å°±æ˜¯flanneldè¿›ç¨‹ï¼Œflanneldè¿›ç¨‹å°±ä¼šå‘èµ·ä¸€ä¸ªUDPè¿æ¥å°†æ•°æ®åŒ…è½¬å‘è‡³ç›®æ ‡ä¸»æœºï¼Œè¿™å°±æ˜¯flannel UDPæ¨¡å¼çš„å¤§è‡´æµç¨‹ã€‚å…¶ä¸­subnetå’Œå®¿ä¸»æœºçš„å…³ç³»æ˜¯ä¿å­˜åœ¨etcdä¸­ã€‚ ä»ç½‘ç»œåè®®æ ˆçš„æ¨ªæˆªé¢æ¥çœ‹çš„è¯ï¼Œä»docker0ç”±ç»è·¯ç”±è¡¨è½¬å‘åˆ°flannel0æ˜¯å†…æ ¸æ€çš„æ“ä½œï¼Œflannel0è½¬å‘ç»™flanneldä¼šä»å†…æ ¸æ€åˆ°ç”¨æˆ·æ€ï¼Œè€Œflanneldå¯¹æ•°æ®è¿›è¡Œå°åŒ…ä»¥åä¼šå†æ¬¡æµè¿‡åè®®æ ˆåˆ°eth0ç½‘å¡è½¬å‘ç»™å…¶ä»–ä¸»æœºï¼Œè¿™å…¶ä¸­éœ€è¦ç»å†ä¸‰æ¬¡å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„å¤åˆ¶ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚ flannel UDP mode\" flannel UDP mode VXLAN mode VXLANæ¨¡å¼å’ŒUDPæ¨¡å¼ååˆ†ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡å°åŒ…å’Œè§£åŒ…çš„éš§é“æ¨¡å¼æ„å»ºoverlayç½‘ç»œæ‰“é€šèŠ‚ç‚¹ã€‚ VXLANæ¨¡å¼å¯ä»¥åˆ©ç”¨Linuxå†…æ ¸çš„VXLANæ¨¡å—åœ¨å†…æ ¸ä¸­ç›´æ¥å°è£…å’Œè§£å°è£…ã€‚è¿™å°±å…å»äº†åƒUDPæ¨¡å¼ä¸‹å†…æ ¸æ€çš„flannel0æµå‘ç”¨æˆ·æ€çš„flanneldï¼Œç„¶ååœ¨flanneldä¸­å°åŒ…ï¼Œå†æµå‘eth0è¿™ä¸ªè¿‡ç¨‹ã€‚è¿™æ ·å°±æé«˜äº†æ•ˆç‡ï¼Œæ‰€ä»¥VXLANæˆä¸ºäº†ä¸»æµçš„è·¨ä¸»é€šä¿¡æ–¹æ¡ˆã€‚å…¶ä¸­VTEPï¼ˆVXLAN tunnel end pointï¼Œè™šæ‹Ÿéš§é“ç«¯ç‚¹ï¼‰å°±ç±»ä¼¼flannel0çš„ä½œç”¨ã€‚ VXLANé€šä¿¡çš„è¿‡ç¨‹ç›¸å½“å¤æ‚ï¼Œå…·ä½“è§ã€Šæ·±å…¥å‰–æKubernetesã€‹P264-267ã€‚ flannel VXLAN mode\" flannel VXLAN mode host-gw mode host-gwæ¨¡å¼æ˜¯ä¸€ç§ä¸‰å±‚ç½‘ç»œæ–¹æ¡ˆï¼Œhost-gwæ¨¡å¼çš„å·¥ä½œåŸç†éå¸¸ç®€å•ï¼Œå…¶å®å°±æ˜¯å°†æ¯ä¸ª Flannel å­ç½‘ï¼ˆFlannel Subnetï¼Œæ¯”å¦‚ï¼š10.244.1.0/24ï¼‰çš„â€œä¸‹ä¸€è·³â€ï¼Œè®¾ç½®æˆäº†è¯¥å­ç½‘å¯¹åº”çš„å®¿ä¸»æœºçš„ IP åœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™å°â€œä¸»æœºâ€ï¼ˆHostï¼‰ä¼šå……å½“è¿™æ¡å®¹å™¨é€šä¿¡è·¯å¾„é‡Œçš„â€œç½‘å…³â€ï¼ˆGatewayï¼‰ã€‚è¿™ä¹Ÿæ­£æ˜¯â€œhost-gwâ€çš„å«ä¹‰ã€‚å½“ç„¶ï¼ŒFlannel å­ç½‘å’Œä¸»æœºçš„ä¿¡æ¯ï¼Œéƒ½æ˜¯ä¿å­˜åœ¨ Etcd å½“ä¸­çš„ã€‚flanneld åªéœ€è¦ WACTH è¿™äº›æ•°æ®çš„å˜åŒ–ï¼Œç„¶åå®æ—¶æ›´æ–°è·¯ç”±è¡¨å³å¯ã€‚ åœ¨ Kubernetes v1.7 ä¹‹åï¼Œç±»ä¼¼ Flannelã€Calico çš„ CNI ç½‘ç»œæ’ä»¶éƒ½æ˜¯å¯ä»¥ç›´æ¥è¿æ¥ Kubernetes çš„ APIServer æ¥è®¿é—® Etcd çš„ï¼Œæ— éœ€é¢å¤–éƒ¨ç½² Etcd ç»™å®ƒä»¬ä½¿ç”¨ã€‚ è€Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå®¹å™¨é€šä¿¡çš„è¿‡ç¨‹å°±å…é™¤äº†é¢å¤–çš„å°åŒ…å’Œè§£åŒ…å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚æ ¹æ®å®é™…çš„æµ‹è¯•ï¼Œhost-gw çš„æ€§èƒ½æŸå¤±å¤§çº¦åœ¨ 10% å·¦å³ï¼Œè€Œå…¶ä»–æ‰€æœ‰åŸºäº VXLANâ€œéš§é“â€æœºåˆ¶çš„ç½‘ç»œæ–¹æ¡ˆï¼Œæ€§èƒ½æŸå¤±éƒ½åœ¨ 20%~30% å·¦å³ã€‚host-gw æ¨¡å¼èƒ½å¤Ÿæ­£å¸¸å·¥ä½œçš„æ ¸å¿ƒï¼Œå°±åœ¨äº IP åŒ…åœ¨å°è£…æˆå¸§å‘é€å‡ºå»çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨è·¯ç”±è¡¨é‡Œçš„â€œä¸‹ä¸€è·³â€æ¥è®¾ç½®ç›®çš„ MAC åœ°å€ã€‚è¿™æ ·ï¼Œå®ƒå°±ä¼šç»è¿‡äºŒå±‚ç½‘ç»œåˆ°è¾¾ç›®çš„å®¿ä¸»æœºã€‚æ‰€ä»¥è¯´ï¼ŒFlannel host-gw æ¨¡å¼å¿…é¡»è¦æ±‚é›†ç¾¤å®¿ä¸»æœºä¹‹é—´æ˜¯äºŒå±‚è¿é€šçš„ã€‚è¿™æ ·ä¹Ÿå°è¯äº†å®˜æ–¹å¯¹host-gwçš„\"Requires direct layer2 connectivity between hosts running flannel.â€œè¯´æ³•ã€‚ ","date":"2022-04-01","objectID":"/posts/22-04-01/:2:1","tags":["Network"],"title":"Kubernetesç½‘ç»œæ¨¡å‹","uri":"/posts/22-04-01/"},{"categories":["Kubernetes"],"content":"Calico Calicoæ˜¯ä¸‰å±‚è½¬å‘ç½‘ç»œè§£å†³æ–¹æ¡ˆçš„å…¸å‹ä»£è¡¨ã€‚ å®é™…ä¸Šï¼ŒCalico é¡¹ç›®æä¾›çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œä¸ Flannel çš„ host-gw æ¨¡å¼ï¼Œå‡ ä¹æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒCalico ä¹Ÿä¼šåœ¨æ¯å°å®¿ä¸»æœºä¸Šï¼Œæ·»åŠ ä¸€ä¸ªå»å¾€ä¸‹ä¸€ä¸ªnodeçš„è·¯ç”±è§„åˆ™ã€‚ è€Œæ­£å¦‚å‰æ‰€è¿°ï¼Œè¿™ä¸ªä¸‰å±‚ç½‘ç»œæ–¹æ¡ˆå¾—ä»¥æ­£å¸¸å·¥ä½œçš„æ ¸å¿ƒï¼Œæ˜¯ä¸ºæ¯ä¸ªå®¹å™¨çš„ IP åœ°å€ï¼Œæ‰¾åˆ°å®ƒæ‰€å¯¹åº”çš„ã€â€œä¸‹ä¸€è·³â€çš„ç½‘å…³ã€‚ä¸è¿‡ï¼Œä¸åŒäº Flannel é€šè¿‡ Etcd å’Œå®¿ä¸»æœºä¸Šçš„ flanneld æ¥ç»´æŠ¤è·¯ç”±ä¿¡æ¯çš„åšæ³•ï¼ŒCalico é¡¹ç›®ä½¿ç”¨äº†BGPè·¯ç”±å®¢æˆ·ç«¯æ¥è‡ªåŠ¨åœ°åœ¨æ•´ä¸ªé›†ç¾¤ä¸­åˆ†å‘è·¯ç”±ä¿¡æ¯ã€‚BGPçš„å·¥ä½œåŸç†å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šåœ¨æ¯ä¸ªè¾¹ç•Œç½‘å…³ä¸Šéƒ½ä¼šè¿è¡Œç€ä¸€ä¸ªBGPå®¢æˆ·ç«¯ï¼Œå®ƒä»¬ä¼šå°†å„è‡ªçš„è·¯ç”±è¡¨ä¿¡æ¯ï¼Œé€šè¿‡ TCP ä¼ è¾“ç»™å…¶ä»–çš„è¾¹ç•Œç½‘å…³ã€‚è€Œå…¶ä»–è¾¹ç•Œç½‘å…³ä¸Šçš„BGPå®¢æˆ·ç«¯ï¼Œåˆ™ä¼šå¯¹æ”¶åˆ°çš„è¿™äº›æ•°æ®è¿›è¡Œåˆ†æï¼Œç„¶åå°†éœ€è¦çš„ä¿¡æ¯æ·»åŠ åˆ°è‡ªå·±çš„è·¯ç”±è¡¨é‡Œã€‚æ‰€è°“ BGPï¼Œå°±æ˜¯åœ¨å¤§è§„æ¨¡ç½‘ç»œä¸­å®ç°èŠ‚ç‚¹è·¯ç”±ä¿¡æ¯å…±äº«çš„ä¸€ç§åè®®ã€‚ Calicoé¡¹ç›®çš„æ¶æ„ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š Calico çš„ CNI æ’ä»¶ã€‚ Felixã€‚å®ƒæ˜¯ä¸€ä¸ª DaemonSetï¼Œè´Ÿè´£åœ¨å®¿ä¸»æœºä¸Šæ’å…¥è·¯ç”±è§„åˆ™ï¼ˆå³ï¼šå†™å…¥ Linux å†…æ ¸çš„ FIB è½¬å‘ä¿¡æ¯åº“ï¼‰ï¼Œä»¥åŠç»´æŠ¤ Calico æ‰€éœ€çš„ç½‘ç»œè®¾å¤‡ç­‰å·¥ä½œã€‚ BIRDã€‚å®ƒå°±æ˜¯ BGP çš„å®¢æˆ·ç«¯ï¼Œä¸“é—¨è´Ÿè´£åœ¨é›†ç¾¤é‡Œåˆ†å‘è·¯ç”±è§„åˆ™ä¿¡æ¯ã€‚ é™¤äº†å¯¹è·¯ç”±ä¿¡æ¯çš„ç»´æŠ¤æ–¹å¼ä¹‹å¤–ï¼ŒCalico é¡¹ç›®ä¸ Flannel çš„ host-gw æ¨¡å¼çš„å¦ä¸€ä¸ªä¸åŒä¹‹å¤„ï¼Œå°±æ˜¯å®ƒä¸ä¼šåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä»»ä½•ç½‘æ¡¥è®¾å¤‡ã€‚ Calico\" Calico éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCalico ç»´æŠ¤çš„ç½‘ç»œåœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œæ˜¯ä¸€ä¸ªè¢«ç§°ä¸ºâ€œNode-to-Node Meshâ€çš„æ¨¡å¼ã€‚è¿™æ—¶å€™ï¼Œæ¯å°å®¿ä¸»æœºä¸Šçš„ BGP Client éƒ½éœ€è¦è·Ÿå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹çš„ BGP Client è¿›è¡Œé€šä¿¡ä»¥ä¾¿äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œéšç€èŠ‚ç‚¹æ•°é‡ N çš„å¢åŠ ï¼Œè¿™äº›è¿æ¥çš„æ•°é‡å°±ä¼šä»¥ NÂ²çš„è§„æ¨¡å¿«é€Ÿå¢é•¿ï¼Œä»è€Œç»™é›†ç¾¤æœ¬èº«çš„ç½‘ç»œå¸¦æ¥å·¨å¤§çš„å‹åŠ›ã€‚ æ‰€ä»¥ï¼ŒNode-to-Node Mesh æ¨¡å¼ä¸€èˆ¬æ¨èç”¨åœ¨å°‘äº 100 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤é‡Œã€‚è€Œåœ¨æ›´å¤§è§„æ¨¡çš„é›†ç¾¤ä¸­ï¼Œåˆ™éœ€è¦ç”¨åˆ°çš„æ˜¯ä¸€ä¸ªå«ä½œ Route Reflector çš„æ¨¡å¼ã€‚ åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒCalico ä¼šæŒ‡å®šä¸€ä¸ªæˆ–è€…å‡ ä¸ªä¸“é—¨çš„èŠ‚ç‚¹ï¼Œæ¥è´Ÿè´£è·Ÿæ‰€æœ‰èŠ‚ç‚¹å»ºç«‹ BGP è¿æ¥ä»è€Œå­¦ä¹ åˆ°å…¨å±€çš„è·¯ç”±è§„åˆ™ã€‚è€Œå…¶ä»–èŠ‚ç‚¹ï¼Œåªéœ€è¦è·Ÿè¿™å‡ ä¸ªä¸“é—¨çš„èŠ‚ç‚¹äº¤æ¢è·¯ç”±ä¿¡æ¯ï¼Œå°±å¯ä»¥è·å¾—æ•´ä¸ªé›†ç¾¤çš„è·¯ç”±è§„åˆ™ä¿¡æ¯äº†ã€‚è¿™äº›ä¸“é—¨çš„èŠ‚ç‚¹ï¼Œå°±æ˜¯æ‰€è°“çš„ Route Reflector èŠ‚ç‚¹ï¼Œå®ƒä»¬å®é™…ä¸Šæ‰®æ¼”äº†â€œä¸­é—´ä»£ç†â€çš„è§’è‰²ï¼Œä»è€ŒæŠŠ BGP è¿æ¥çš„è§„æ¨¡æ§åˆ¶åœ¨ N çš„æ•°é‡çº§ä¸Šã€‚ æ­¤å¤–ï¼ŒFlannel host-gw æ¨¡å¼æœ€ä¸»è¦çš„é™åˆ¶ï¼Œå°±æ˜¯è¦æ±‚é›†ç¾¤å®¿ä¸»æœºä¹‹é—´æ˜¯äºŒå±‚è¿é€šçš„ã€‚è€Œè¿™ä¸ªé™åˆ¶å¯¹äº Calico æ¥è¯´ï¼Œä¹ŸåŒæ ·å­˜åœ¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ä¸ºCalicoå¼€å¯IPIPæ¨¡å¼ã€‚IPIPæ¨¡å¼çš„å«ä¹‰å°±æ˜¯IP in IPï¼Œå°±å¦‚åŒflannelçš„MAC in UDPä¸€æ ·æ˜¯é€šè¿‡å°åŒ…å’Œè§£åŒ…çš„éš§é“æ¨¡å¼è¿›è¡Œä¼ è¾“ã€‚åœ¨å®é™…æµ‹è¯•ä¸­ï¼ŒCalico IPIP æ¨¡å¼ä¸ Flannel VXLAN æ¨¡å¼çš„æ€§èƒ½å¤§è‡´ç›¸å½“ã€‚æ‰€ä»¥ï¼Œåœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œå¦‚éç¡¬æ€§éœ€æ±‚ï¼Œå»ºè®®å°†æ‰€æœ‰å®¿ä¸»æœºèŠ‚ç‚¹æ”¾åœ¨ä¸€ä¸ªå­ç½‘é‡Œï¼Œé¿å…ä½¿ç”¨ IPIPã€‚ ä½†æ˜¯å¦‚æœ Calico é¡¹ç›®èƒ½å¤Ÿè®©å®¿ä¸»æœºä¹‹é—´çš„è·¯ç”±è®¾å¤‡ï¼ˆä¹Ÿå°±æ˜¯ç½‘å…³ï¼‰ï¼Œä¹Ÿé€šè¿‡ BGP åè®®â€œå­¦ä¹ â€åˆ° Calico ç½‘ç»œé‡Œçš„è·¯ç”±è§„åˆ™ï¼Œé‚£ä¹ˆä»å®¹å™¨å‘å‡ºçš„ IP åŒ…ï¼Œä¸å°±å¯ä»¥é€šè¿‡è¿™äº›è®¾å¤‡è·¯ç”±åˆ°ç›®çš„å®¿ä¸»æœºäº†ä¹ˆï¼Ÿä½†æ˜¯åœ¨ Kubernetes è¢«å¹¿æ³›ä½¿ç”¨çš„å…¬æœ‰äº‘åœºæ™¯é‡Œï¼Œå´å®Œå…¨ä¸å¯è¡Œã€‚è¿™é‡Œçš„åŸå› åœ¨äºï¼šå…¬æœ‰äº‘ç¯å¢ƒä¸‹ï¼Œå®¿ä¸»æœºä¹‹é—´çš„ç½‘å…³ï¼Œè‚¯å®šä¸ä¼šå…è®¸ç”¨æˆ·è¿›è¡Œå¹²é¢„å’Œè®¾ç½®ã€‚å½“ç„¶ï¼Œåœ¨å¤§å¤šæ•°å…¬æœ‰äº‘ç¯å¢ƒä¸‹ï¼Œå®¿ä¸»æœºï¼ˆå…¬æœ‰äº‘æä¾›çš„è™šæ‹Ÿæœºï¼‰æœ¬èº«å¾€å¾€å°±æ˜¯äºŒå±‚è¿é€šçš„ï¼Œæ‰€ä»¥è¿™ä¸ªéœ€æ±‚ä¹Ÿä¸å¼ºçƒˆã€‚ä¸è¿‡ï¼Œåœ¨ç§æœ‰éƒ¨ç½²çš„ç¯å¢ƒä¸‹ï¼Œå®¿ä¸»æœºå±äºä¸åŒå­ç½‘ï¼ˆVLANï¼‰åè€Œæ˜¯æ›´åŠ å¸¸è§çš„éƒ¨ç½²çŠ¶æ€ã€‚è¿™æ—¶å€™ï¼Œæƒ³åŠæ³•å°†å®¿ä¸»æœºç½‘å…³ä¹ŸåŠ å…¥åˆ° BGP Mesh é‡Œä»è€Œé¿å…ä½¿ç”¨ IPIPï¼Œå°±æˆäº†ä¸€ä¸ªéå¸¸è¿«åˆ‡çš„éœ€æ±‚ã€‚è€Œåœ¨ Calico é¡¹ç›®ä¸­ï¼Œå·²ç»æä¾›äº†ä¸¤ç§å°†å®¿ä¸»æœºç½‘å…³è®¾ç½®æˆ BGP Peer çš„è§£å†³æ–¹æ¡ˆã€‚ ç¬¬ä¸€ç§æ–¹æ¡ˆéœ€è¦ä¸ºBGPé…ç½®Dynamic Neighborsï¼Œè¿™æ ·å°±å¯ä»¥ç»™è·¯ç”±å™¨é…ç½®ä¸€ä¸ªç½‘æ®µï¼Œç„¶åè·¯ç”±å™¨å°±ä¼šè‡ªåŠ¨è·Ÿè¯¥ç½‘æ®µé‡Œçš„ä¸»æœºå»ºç«‹èµ· BGP Peer å…³ç³»ã€‚ ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹ç»„ä»¶è´Ÿè´£æœé›†æ•´ä¸ªé›†ç¾¤é‡Œçš„æ‰€æœ‰è·¯ç”±ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ BGP åè®®åŒæ­¥ç»™ç½‘å…³ã€‚å‰é¢æåˆ°ï¼Œåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­ï¼ŒCalico æœ¬èº«å°±æ¨èä½¿ç”¨ Route Reflector èŠ‚ç‚¹çš„æ–¹å¼è¿›è¡Œç»„ç½‘ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œè´Ÿè´£è·Ÿå®¿ä¸»æœºç½‘å…³è¿›è¡Œæ²Ÿé€šçš„ç‹¬ç«‹ç»„ä»¶ï¼Œç›´æ¥ç”± Route Reflector å…¼ä»»å³å¯ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ç§æƒ…å†µä¸‹ç½‘å…³çš„ BGP Peer ä¸ªæ•°æ˜¯æœ‰é™å¹¶ä¸”å›ºå®šçš„ã€‚æ‰€ä»¥å°±å¯ä»¥ç›´æ¥æŠŠè¿™äº›ç‹¬ç«‹ç»„ä»¶é…ç½®æˆè·¯ç”±å™¨çš„ BGP Peerï¼Œè€Œæ— éœ€ Dynamic Neighbors çš„æ”¯æŒã€‚ ","date":"2022-04-01","objectID":"/posts/22-04-01/:2:2","tags":["Network"],"title":"Kubernetesç½‘ç»œæ¨¡å‹","uri":"/posts/22-04-01/"},{"categories":["Kubernetes"],"content":"ç½‘ç»œéš”ç¦» åœ¨ Kubernetes é‡Œï¼Œç½‘ç»œéš”ç¦»èƒ½åŠ›çš„å®šä¹‰ï¼Œæ˜¯ä¾é ä¸€ç§ä¸“é—¨çš„ API å¯¹è±¡æ¥æè¿°çš„ï¼Œå³ï¼šNetworkPolicyã€‚ ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š apiVersion:networking.k8s.io/v1kind:NetworkPolicymetadata:name:test-network-policynamespace:defaultspec:podSelector:matchLabels:role:dbpolicyTypes:- Ingress- Egressingress:- from:- ipBlock:cidr:172.17.0.0/16except:- 172.17.1.0/24- namespaceSelector:matchLabels:project:myproject- podSelector:matchLabels:role:frontendports:- protocol:TCPport:6379egress:- to:- ipBlock:cidr:10.0.0.0/24ports:- protocol:TCPport:5978è¿™é‡Œéœ€è¦æ˜ç¡®ï¼ŒKubernetes é‡Œçš„ Pod é»˜è®¤éƒ½æ˜¯â€œå…è®¸æ‰€æœ‰â€ï¼ˆAccept Allï¼‰çš„ï¼Œå³ï¼šPod å¯ä»¥æ¥æ”¶æ¥è‡ªä»»ä½•å‘é€æ–¹çš„è¯·æ±‚ï¼›æˆ–è€…ï¼Œå‘ä»»ä½•æ¥æ”¶æ–¹å‘é€è¯·æ±‚ã€‚è€Œå¦‚æœä½ è¦å¯¹è¿™ä¸ªæƒ…å†µä½œå‡ºé™åˆ¶ï¼Œå°±å¿…é¡»é€šè¿‡ NetworkPolicy å¯¹è±¡æ¥æŒ‡å®šã€‚è€Œä¸€æ—¦ Pod è¢« NetworkPolicy é€‰ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ª Pod å°±ä¼šè¿›å…¥â€œæ‹’ç»æ‰€æœ‰â€ï¼ˆDeny Allï¼‰çš„çŠ¶æ€ï¼Œå³ï¼šè¿™ä¸ª Pod æ—¢ä¸å…è®¸è¢«å¤–ç•Œè®¿é—®ï¼Œä¹Ÿä¸å…è®¸å¯¹å¤–ç•Œå‘èµ·è®¿é—®ã€‚è€Œ NetworkPolicy å®šä¹‰çš„è§„åˆ™ï¼Œå…¶å®å°±æ˜¯â€œç™½åå•â€ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­é‡Œï¼Œåœ¨ policyTypes å­—æ®µï¼Œå®šä¹‰äº†è¿™ä¸ª NetworkPolicy çš„ç±»å‹æ˜¯ ingress å’Œ egressï¼Œå³ï¼šå®ƒæ—¢ä¼šå½±å“æµå…¥ï¼ˆingressï¼‰è¯·æ±‚ï¼Œä¹Ÿä¼šå½±å“æµå‡ºï¼ˆegressï¼‰è¯·æ±‚ã€‚ç„¶åï¼Œåœ¨ ingress å­—æ®µé‡Œï¼Œå®šä¹‰äº† from å’Œ portsï¼Œå³ï¼šå…è®¸æµå…¥çš„â€œç™½åå•â€å’Œç«¯å£ã€‚å…¶ä¸­ï¼Œè¿™ä¸ªå…è®¸æµå…¥çš„â€œç™½åå•â€é‡Œï¼ŒæŒ‡å®šäº†ä¸‰ç§å¹¶åˆ—çš„æƒ…å†µï¼Œåˆ†åˆ«æ˜¯ï¼šipBlockã€namespaceSelector å’Œ podSelectorã€‚è€Œåœ¨ egress å­—æ®µé‡Œï¼Œåˆ™å®šä¹‰äº† to å’Œ portsï¼Œå³ï¼šå…è®¸æµå‡ºçš„â€œç™½åå•â€å’Œç«¯å£ã€‚è¿™é‡Œå…è®¸æµå‡ºçš„â€œç™½åå•â€çš„å®šä¹‰æ–¹æ³•ä¸ ingress ç±»ä¼¼ã€‚åªä¸è¿‡ï¼Œè¿™ä¸€æ¬¡ ipblock å­—æ®µæŒ‡å®šçš„ï¼Œæ˜¯ç›®çš„åœ°å€çš„ç½‘æ®µã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™ä¸ª NetworkPolicy å¯¹è±¡ï¼ŒæŒ‡å®šçš„éš”ç¦»è§„åˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š è¯¥éš”ç¦»è§„åˆ™åªå¯¹ default Namespace ä¸‹çš„ï¼Œæºå¸¦äº† role=db æ ‡ç­¾çš„ Pod æœ‰æ•ˆã€‚é™åˆ¶çš„è¯·æ±‚ç±»å‹åŒ…æ‹¬ ingressï¼ˆæµå…¥ï¼‰å’Œ egressï¼ˆæµå‡ºï¼‰ã€‚ Kubernetes ä¼šæ‹’ç»ä»»ä½•è®¿é—®è¢«éš”ç¦» Pod çš„è¯·æ±‚ï¼Œé™¤éè¿™ä¸ªè¯·æ±‚æ¥è‡ªäºä»¥ä¸‹â€œç™½åå•â€é‡Œçš„å¯¹è±¡ï¼Œå¹¶ä¸”è®¿é—®çš„æ˜¯è¢«éš”ç¦» Pod çš„ 6379 ç«¯å£ã€‚è¿™äº›â€œç™½åå•â€å¯¹è±¡åŒ…æ‹¬ï¼ša. default Namespace é‡Œçš„ï¼Œæºå¸¦äº† role=fronted æ ‡ç­¾çš„ Podï¼›b. æºå¸¦äº† project=myproject æ ‡ç­¾çš„ Namespace é‡Œçš„ä»»ä½• Podï¼›c. ä»»ä½•æºåœ°å€å±äº 172.17.0.0/16 ç½‘æ®µï¼Œä¸”ä¸å±äº 172.17.1.0/24 ç½‘æ®µçš„è¯·æ±‚ã€‚ Kubernetes ä¼šæ‹’ç»è¢«éš”ç¦» Pod å¯¹å¤–å‘èµ·ä»»ä½•è¯·æ±‚ï¼Œé™¤éè¯·æ±‚çš„ç›®çš„åœ°å€å±äº 10.0.0.0/24 ç½‘æ®µï¼Œå¹¶ä¸”è®¿é—®çš„æ˜¯è¯¥ç½‘æ®µåœ°å€çš„ 5978 ç«¯å£ã€‚ è€Œè¿™ç§ç­–ç•¥çš„æœ¬è´¨ä¹Ÿæ˜¯é€šè¿‡iptablesæ¥æ§åˆ¶çš„ã€‚ ","date":"2022-04-01","objectID":"/posts/22-04-01/:3:0","tags":["Network"],"title":"Kubernetesç½‘ç»œæ¨¡å‹","uri":"/posts/22-04-01/"},{"categories":["Kubernetes"],"content":"Serviceå’ŒDNS Kubernetes ä» 1.11 ç‰ˆæœ¬å¼€å§‹ï¼Œä½¿ç”¨ CoreDNS æ›¿ä»£ KubeDNS æˆä¸ºäº†å†…ç½®çš„ DNS æœåŠ¡ã€‚ æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªbusybox Podï¼Œç„¶åæ‰§è¡Œ kubectl exec busybox cat /etc/resolv.conf search default.svc.cluster.local svc.cluster.local cluster.local nameserver 169.254.20.10 options ndots:5 å¯è§æœç´¢åŸŸæ˜¯default.svc.cluster.localã€svc.cluster.localå’Œcluster.local DNSæ»¡è¶³äº†æœåŠ¡å‘ç°çš„éœ€æ±‚ã€‚ ä¹‹å‰æˆ‘åœ¨Serviceç®€è®°ä¸­æè¿°è¿‡ClusterIPå’ŒNodePortç±»å‹Serviceçš„ç½‘ç»œåŸç†ã€‚Serviceè¿˜æœ‰headlessã€LoadBalancerå’ŒExternalNameç±»å‹ã€‚ LoadBalancer Serviceç±»å‹éœ€è¦Cloud Providerçš„æ”¯æŒ Headless Serviceç±»å‹è¿”å›è¯¥Serviceé€‰æ‹©åˆ°çš„Podçš„åœ°å€ ExternalName Serviceå¯ä»¥ç»™ä¸€ä¸ªå¤–éƒ¨æœåŠ¡èµ·ä¸€ä¸ªå†…éƒ¨åˆ«å ","date":"2022-04-01","objectID":"/posts/22-04-01/:4:0","tags":["Network"],"title":"Kubernetesç½‘ç»œæ¨¡å‹","uri":"/posts/22-04-01/"},{"categories":["Kubernetes"],"content":"Ingress Ingresså¯¹è±¡æä¾›ä»£ç†ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®åŸŸåå’Œpathçš„è§„åˆ™è®¿é—®åˆ°å†…éƒ¨çš„Serviceã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡æäº¤Ingresså¯¹è±¡è®¾ç½®åå‘ä»£ç†è§„åˆ™ï¼Œä½†æ˜¯çœŸæ­£å®ç°åå‘ä»£ç†åŠŸèƒ½çš„æ˜¯Ingress-Controllerã€‚å¸¸è§çš„Ingress-Controlleræœ‰Nginxã€HAproxyå’Œtraefikã€‚k3så†…ç½®äº†traefikï¼Œtraefikçš„ä¼˜åŠ¿å°±åœ¨ä¸çƒ­åŠ è½½ã€‚ ä»¥å¸¸ç”¨çš„Nginxå®ç°ä¸ºä¾‹ï¼Œå½“æˆ‘ä»¬æäº¤Ingressï¼Œå…¶å®å°±æ˜¯è®¾ç½®äº†nginx.confï¼Œå°±å®ç°äº†åå‘ä»£ç†çš„åŠŸèƒ½ã€‚Ingressè¿˜å¯ä»¥æ–¹ä¾¿çš„é…ç½®TLSã€‚ ","date":"2022-04-01","objectID":"/posts/22-04-01/:5:0","tags":["Network"],"title":"Kubernetesç½‘ç»œæ¨¡å‹","uri":"/posts/22-04-01/"},{"categories":["Kubernetes"],"content":"æ€»ç»“ k8sçš„ç½‘ç»œéå¸¸å¤æ‚ï¼Œè¿™é‡Œåªæ˜¯åœ¨æˆ‘é˜…è¯»ã€Šæ·±å…¥å‰–æKubernetesã€‹ç¬¬ä¸ƒç« ä¹‹åçš„ç¬”è®°å’Œä¸ªäººæ€è€ƒï¼Œä»…ä»…æ˜¯æ•´ä¸ªk8sç½‘ç»œæ¨¡å‹ä¸­çš„å†°å±±ä¸€è§’ã€‚ä¾‹å¦‚ï¼šVXLANæŠ€æœ¯å…¶å®æ˜¯åœ¨æ•°æ®ä¸­å¿ƒç½‘ç»œä¸­ä¸ºäº†ä½¿è™šæ‹Ÿæœºä¸œè¥¿è¿ç§»çš„ï¼ŒCNIçš„è°ƒç”¨æµç¨‹ï¼Œå’Œæœ€è¿‘æµè¡Œçš„ä»¥eBPFæŠ€æœ¯ä¸ºåº•åº§ï¼Œæ€§èƒ½ååˆ†ä¹‹é«˜çš„Ciliumæ’ä»¶ç­‰ç­‰ç­‰ç­‰éƒ½æ²¡æœ‰æ¶‰åŠã€‚å¦‚æ­¤å¤æ‚çš„ç½‘ç»œäº§ç”Ÿçš„åŸå› å°±æ˜¯ä¸ºäº†å±è”½åº•å±‚åŸºç¡€è®¾æ–½ï¼Œè®©nodeå’Œnodeä¹‹é—´æ²¡æœ‰éš”ç¦»ï¼ŒPodå¯ä»¥è‡ªç”±çš„é€šè¿‡IPåœ°å€è¿›è¡Œè®¿é—®ï¼Œå°±åƒåœ¨ä¸€ä¸ªå•ä¸€çš„å·¨å¤§çš„èµ„æºå¤§æµ·é‡Œä¸€æ ·ã€‚ ç†è§£k8sç½‘ç»œæ¨¡å‹æ˜¯æ·±å…¥äº†è§£k8sçš„å¿…ç”±ä¹‹è·¯ï¼Œåªæœ‰æ·±åˆ»ç†è§£äº†k8sä¸­çš„ç½‘ç»œæ‰èƒ½æ›´å¥½çš„ç†è§£k8sçš„è®¾è®¡ã€‚ lol\" lol ","date":"2022-04-01","objectID":"/posts/22-04-01/:6:0","tags":["Network"],"title":"Kubernetesç½‘ç»œæ¨¡å‹","uri":"/posts/22-04-01/"},{"categories":["Golang"],"content":"æ³›å‹æ¥äº†ï¼ ","date":"2022-03-16","objectID":"/posts/22-03-16/:0:0","tags":["Golang"],"title":"Today is the big day!","uri":"/posts/22-03-16/"},{"categories":["Istio"],"content":"æ³¨å…¥å®¹å™¨ï¼æ¥ç®¡æµé‡ï¼ ","date":"2022-02-28","objectID":"/posts/22-02-28/:0:0","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Istio"],"content":"Istioæ˜¯ä»€ä¹ˆ? ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹ æ¦‚è¿° äº‘åŸç”Ÿå®¹å™¨æŠ€æœ¯å’Œå¾®æœåŠ¡åº”ç”¨çš„å‡ºç°ï¼Œæ¨åŠ¨äº†äººä»¬å¯¹æœåŠ¡ç½‘æ ¼çš„éœ€æ±‚ã€‚é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿç®€è€Œè¨€ä¹‹ï¼ŒæœåŠ¡ç½‘æ ¼æ˜¯æœåŠ¡ï¼ˆåŒ…æ‹¬å¾®æœåŠ¡ï¼‰ä¹‹é—´é€šä¿¡çš„æ§åˆ¶å™¨ã€‚éšç€è¶Šæ¥è¶Šå¤šçš„å®¹å™¨åº”ç”¨çš„å¼€å‘å’Œéƒ¨ç½²ï¼Œä¸€ä¸ªä¼ä¸šå¯èƒ½ä¼šæœ‰æˆç™¾ä¸Šåƒæˆ–æ•°ä»¥ä¸‡è®¡çš„å®¹å™¨åœ¨è¿è¡Œï¼Œæ€æ ·ç®¡ç†è¿™äº›å®¹å™¨æˆ–æœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼ŒåŒ…æ‹¬æœåŠ¡é—´çš„è´Ÿè½½å‡è¡¡ã€æµé‡ç®¡ç†ã€è·¯ç”±ã€è¿è¡ŒçŠ¶å†µç›‘è§†ã€å®‰å…¨ç­–ç•¥åŠæœåŠ¡é—´èº«ä»½éªŒè¯ï¼Œå°±æˆä¸ºäº‘åŸç”ŸæŠ€æœ¯çš„å·¨å¤§æŒ‘æˆ˜ã€‚ä»¥Istioä¸ºä»£è¡¨çš„æœåŠ¡ç½‘æ ¼åº”è¿è€Œç”Ÿã€‚åœ¨æ¶æ„ä¸Šï¼ŒIstioå±äºäº‘åŸç”ŸæŠ€æœ¯çš„åŸºç¡€è®¾æ–½å±‚ï¼Œé€šè¿‡åœ¨å®¹å™¨æ—æä¾›ä¸€ç³»åˆ—ç½‘ç»œä»£ç†ï¼Œæ¥å®ç°æœåŠ¡é—´çš„é€šä¿¡æ§åˆ¶ã€‚å…¶ä¸­çš„æ¯ä¸ªç½‘ç»œä»£ç†å°±æ˜¯ä¸€ä¸ªç½‘å…³ï¼Œç®¡ç†å®¹å™¨æˆ–å®¹å™¨é›†ç¾¤ä¸­æ¯ä¸ªæœåŠ¡é—´çš„è¯·æ±‚æˆ–äº¤äº’ã€‚æ¯ä¸ªç½‘ç»œä»£ç†è¿˜æ‹¦æˆªæœåŠ¡è¯·æ±‚åˆ†å‘åˆ°æœåŠ¡ç½‘æ ¼ä¸Šï¼Œå› æ­¤ï¼Œä¼—å¤šæœåŠ¡æ„æˆçš„æ— æ•°è¿æ¥â€œç¼–ç»‡â€œæˆç½‘ï¼Œä¹Ÿå°±æœ‰äº†â€œç½‘æ ¼â€œè¿™ä¸ªæ¦‚å¿µã€‚æœåŠ¡ç½‘æ ¼çš„ä¸­å¤®æ§åˆ¶å™¨ï¼Œåœ¨Kuberneteså®¹å™¨å¹³å°çš„å¸®åŠ©ä¸‹ï¼Œé€šè¿‡æœåŠ¡ç­–ç•¥æ¥æ§åˆ¶å’Œè°ƒæ•´ç½‘ç»œä»£ç†çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ”¶é›†æœåŠ¡çš„æ€§èƒ½æŒ‡æ ‡ã€‚ ä¸€å¥è¯æ€»ç»“ï¼šIstioæ˜¯ä¸€ä¸ªä¸Kubernetesç´§å¯†ç»“åˆçš„é€‚ç”¨äºäº‘åŸç”Ÿåœºæ™¯çš„Service Meshå½¢æ€çš„ç”¨äºæœåŠ¡æ²»ç†çš„å¼€æ”¾å¹³å°ã€‚ Istio Architecture\" Istio Architecture ","date":"2022-02-28","objectID":"/posts/22-02-28/:1:0","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Istio"],"content":"Istioèƒ½åšä»€ä¹ˆ? Connect Secure Control Observe ","date":"2022-02-28","objectID":"/posts/22-02-28/:2:0","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Istio"],"content":"ä¸ºä»€ä¹ˆéœ€è¦Istio? æˆ‘ä»¬éœ€è¦è§£å†³æœåŠ¡æ²»ç†é—®é¢˜ã€‚ æœåŠ¡æ²»ç†çš„æ¼”åŒ–è¿‡ç¨‹ç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼š åœ¨å¾®æœåŠ¡ç¨‹åºä¸­ç›´æ¥åŒ…å«æ²»ç†é€»è¾‘ã€‚è¿™å°±ä¼šå‡ºç°ä»£ç é‡å¤ï¼Œç»´æŠ¤å›°éš¾ï¼ŒæœåŠ¡æ²»ç†é€»è¾‘å’Œä¸šåŠ¡é€»è¾‘ç´§è€¦åˆç­‰ç­‰é—®é¢˜ã€‚ ç‹¬ç«‹æ²»ç†é€»è¾‘ï¼ŒSDKæ¨¡å¼ã€‚å°†æ²»ç†é€»è¾‘ç‹¬ç«‹å‡ºæ¥ï¼Œå½¢æˆç±»åº“ï¼Œä¾‹å¦‚Spring Cloud Netflix Hystrixå’ŒSpring Cloud OpenFeignï¼Œæˆ‘æ›¾ç»ä½¿ç”¨è¿‡OpenFeignï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿç®—å¼€ç®±å³ç”¨ï¼Œåªéœ€åœ¨SpringBootä»£ç ä¸­çš„è°ƒç”¨é€»è¾‘å¤„æ·»åŠ @FeignClientå’Œ@EnableFeignClientsæ³¨è§£å³å¯ï¼Œè¿™ç§SDKæ¨¡å¼çš„æ²»ç†å·¥å…·é›†åœ¨è¿‡å»ä¸€æ®µæ—¶é—´é‡Œå¾—åˆ°äº†éå¸¸å¹¿æ³›çš„åº”ç”¨ã€‚è™½ç„¶SDKæ¨¡å¼åœ¨ä»£ç ä¸Šè§£è€¦äº†ä¸šåŠ¡å’Œæ²»ç†é€»è¾‘ï¼Œä½†ä¸šåŠ¡ä»£ç å’ŒSDKè¿˜æ˜¯è¦ä¸€èµ·ç¼–è¯‘çš„ï¼Œä¸šåŠ¡ä»£ç å’Œæ²»ç†é€»è¾‘è¿˜åœ¨ä¸€ä¸ªè¿›ç¨‹å†…ã€‚è¿™å°±å¯¼è‡´äº†å‡ ä¸ªé—®é¢˜ï¼šä¸šåŠ¡ä»£ç å¿…é¡»å’ŒSDKåŸºäºåŒä¸€ç§è¯­è¨€ï¼Œå³è¯­è¨€ç»‘å®šã€‚ä¾‹å¦‚ï¼ŒSpring Cloudç­‰å¤§éƒ¨åˆ†æ²»ç†æ¡†æ¶éƒ½åŸºäºJavaï¼Œå› æ­¤åªé€‚ç”¨äºJavaè¯­è¨€å¼€å‘çš„æœåŠ¡ã€‚å¹¶ä¸”åœ¨æ²»ç†é€»è¾‘å‡çº§æ—¶ï¼Œè¿˜éœ€è¦ç”¨æˆ·çš„æ•´ä¸ªæœåŠ¡å‡çº§ï¼Œå³ä½¿ä¸šåŠ¡é€»è¾‘æ²¡æœ‰æ”¹å˜ã€‚ æ²»ç†é€»è¾‘ç‹¬ç«‹çš„è¿›ç¨‹ã€‚SDKæ¨¡å¼ä»æ—§ä¾µå…¥äº†ç”¨æˆ·çš„ä»£ç ï¼Œé‚£å°±å†è§£è€¦ä¸€å±‚ï¼ŒæŠŠæ²»ç†é€»è¾‘å½»åº•ä»ç”¨æˆ·çš„ä¸šåŠ¡ä»£ç ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œè¿™å°±å½¢æˆäº†Sidecaræ¨¡å¼ã€‚ Sidecar\" Sidecar ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹P12 åœ¨äº‘åŸç”Ÿæ—¶ä»£ï¼Œéšç€é‡‡ç”¨å„ç§è¯­è¨€å¼€å‘çš„æœåŠ¡å‰§å¢ï¼Œåº”ç”¨é—´çš„è®¿é—®æ‹“æ‰‘æ›´åŠ å¤æ‚ï¼Œæ²»ç†éœ€æ±‚ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚åŸæ¥çš„é‚£ç§åµŒå…¥åœ¨åº”ç”¨ä¸­çš„æ²»ç†åŠŸèƒ½æ— è®ºæ˜¯ä»å½¢æ€ã€åŠ¨æ€æ€§è¿˜æ˜¯å¯æ‰©å±•æ€§æ¥è¯´éƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œè¿«åˆ‡éœ€è¦ä¸€ç§å…·å¤‡äº‘åŸç”ŸåŠ¨æ€ã€å¼¹æ€§ç‰¹ç‚¹çš„åº”ç”¨æ²»ç†åŸºç¡€è®¾æ–½ã€‚ é¦–å…ˆï¼Œä»å•ä¸ªåº”ç”¨æ¥çœ‹ï¼ŒSidecarä¸åº”ç”¨è¿›ç¨‹çš„è§£è€¦å¸¦æ¥çš„åº”ç”¨å®Œå…¨æ— ä¾µå…¥ã€å¼€å‘è¯­è¨€æ— å…³ç­‰ç‰¹ç‚¹è§£é™¤äº†å¼€å‘è¯­è¨€çš„çº¦æŸï¼Œä»è€Œæå¤§é™ä½äº†åº”ç”¨å¼€å‘è€…çš„å¼€å‘æˆæœ¬ã€‚è¿™ç§æ–¹å¼ç»å¸¸è¢«ç§°ä¸ºä¸€ç§åº”ç”¨çš„åŸºç¡€è®¾æ–½å±‚ï¼Œç±»æ¯”TCP/IPç½‘ç»œåè®®æ ˆï¼Œåº”ç”¨ç¨‹åºåƒä½¿ç”¨TCP/IPä¸€æ ·ä½¿ç”¨è¿™ä¸ªé€šç”¨ä»£ç†ï¼šTCP/IPè´Ÿè´£å°†å­—èŠ‚ç å¯é åœ°åœ¨ç½‘ç»œèŠ‚ç‚¹é—´ä¼ é€’ï¼ŒSidecaråˆ™è´Ÿè´£å°†è¯·æ±‚å¯é åœ°åœ¨æœåŠ¡é—´è¿›è¡Œä¼ é€’ã€‚TCP/IPé¢å‘çš„æ˜¯åº•å±‚çš„æ•°æ®æµï¼ŒSidecaråˆ™å¯ä»¥æ”¯æŒå¤šç§é«˜çº§åè®®ï¼ˆHTTPã€gRPCã€HTTPSç­‰ï¼‰ï¼Œä»¥åŠå¯¹æœåŠ¡è¿è¡Œæ—¶è¿›è¡Œé«˜çº§æ§åˆ¶ï¼Œä½¿æœåŠ¡å˜å¾—å¯ç›‘æ§ã€å¯ç®¡ç†ã€‚ ç„¶åï¼Œä»å…¨å±€æ¥çœ‹ï¼Œåœ¨å¤šä¸ªæœåŠ¡é—´æœ‰å¤æ‚çš„äº’ç›¸è®¿é—®æ—¶æ‰æœ‰æœåŠ¡æ²»ç†çš„éœ€æ±‚ã€‚å³æˆ‘ä»¬å…³æ³¨çš„æ˜¯è¿™äº›Sidecarç»„æˆçš„ç½‘æ ¼ï¼Œå¯¹ç½‘æ ¼å†…çš„æœåŠ¡é—´è®¿é—®è¿›è¡Œç®¡ç†ï¼Œåº”ç”¨è¿˜æ˜¯æŒ‰ç…§æœ¬æ¥çš„æ–¹å¼äº’ç›¸è®¿é—®ï¼Œæ¯ä¸ªç¨‹åºçš„Inboundæµé‡å’ŒOutboundæµé‡éƒ½è¦ç»è¿‡Sidecarä»£ç†ï¼Œå¹¶åœ¨Sidecarä¸Šæ‰§è¡Œæ²»ç†åŠ¨ä½œã€‚ æœ€åï¼ŒSidecaræ˜¯ç½‘æ ¼åŠ¨ä½œçš„æ‰§è¡Œä½“ï¼Œå…¨å±€çš„ç®¡ç†è§„åˆ™å’Œç½‘æ ¼å†…çš„å…ƒæ•°æ®ç»´æŠ¤é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„æ§åˆ¶é¢å®ç°ï¼Œåªæœ‰æ•°å±€é¢çš„Sidecarå’Œæ§åˆ¶é¢æœ‰è”ç³»ï¼Œåº”ç”¨æ„ŸçŸ¥ä¸åˆ°Sidecaræ›´ä¸ä¼šå’Œæ§åˆ¶é¢æœ‰ä»»ä½•è”ç³»ï¼Œç”¨æˆ·çš„ä¸šåŠ¡å’Œæ§åˆ¶é¢å½»åº•è§£è€¦ã€‚ ","date":"2022-02-28","objectID":"/posts/22-02-28/:3:0","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Istio"],"content":"Istioçš„ç¼ºç‚¹ Istioçš„Sidecaræ¶æ„å¼•å…¥äº†ä¸¤ä¸ªé—®é¢˜ï¼š å¢åŠ äº†ä¸¤å¤„å»¶è¿Ÿå’Œå¯èƒ½çš„æ•…éšœç‚¹ å¤šå‡ºæ¥çš„è¿™ä¸¤è·³å¯¹ä¸è®¿é—®æ€§èƒ½ã€æ•´ä½“å¯é æ€§åŠæ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦éƒ½å¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ã€‚ åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸‹éœ€è¦è€ƒè™‘è¿™ç‚¹èµ„æºæŸè€—å—ğŸ¤ªï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¿è¯è½¬å‘ä»£ç†çš„è½»é‡å’Œé«˜æ€§èƒ½é™ä½æ—¶å»¶å½±å“ï¼ˆIstioé€‰æ‹©äº†è½»é‡çº§çš„envoyè€Œä¸æ˜¯nginxå°±æ˜¯å¤„äºè¿™ä¸ªè€ƒè™‘ï¼‰ï¼Œå°¤å…¶æ˜¯è€ƒè™‘åˆ°åç«¯å®é™…ä½¿ç”¨çš„åº”ç”¨ç¨‹åºä¸€èˆ¬æ¯”ä»£ç†æ›´é‡ï¼Œå åŠ ä»£ç†å¹¶ä¸ä¼šæ˜æ˜¾å½±å“åº”ç”¨çš„è®¿é—®æ€§èƒ½ï¼›å¦å¤–ï¼Œåœ¨äº‘åŸç”Ÿåœºæ™¯ä¸‹ï¼Œå¤šæ‰©å±•å‡ ä¸ªreplicaå°±è¡Œäº†ã€‚ ","date":"2022-02-28","objectID":"/posts/22-02-28/:4:0","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Istio"],"content":"Istioå’ŒKubernetes ä¹‹å‰åœ¨Serviceç®€è®°è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘åˆ†æäº†Serviceå®ç°çš„ç½‘ç»œåŸç†ï¼Œå¯ä»¥æ˜ç¡®çš„æ˜¯k8sçš„Serviceå·²ç»å¯ä»¥æä¾›æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æœåŠ¡åç›´æ¥è®¿é—®åˆ°æœåŠ¡å®ä¾‹ï¼ˆDNSï¼‰ã€‚ä¸ºä»€ä¹ˆè¿˜æ˜¯éœ€è¦Istioå‘¢ï¼Ÿæœ¬è´¨ä¸Šæ¥çœ‹ï¼Œæ˜¯å› ä¸ºk8sçš„Serviceåªæä¾›äº†OSIçš„4å±‚è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œæ— æ³•åŸºäºåº”ç”¨å±‚çš„ä¿¡æ¯è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¸ä¼šæä¾›åº”ç”¨å±‚çš„æµé‡ç®¡ç†ï¼Œæ›´ä¸ä¼šæä¾›æœåŠ¡è®¿é—®æŒ‡æ ‡å’Œè°ƒç”¨é“¾è¿½è¸ªè¿™ç§åº”ç”¨çš„æœåŠ¡è¿è¡Œè¯Šæ–­èƒ½åŠ›ã€‚ä½†æ˜¯è¦é—®åˆ°ä¸ºä»€ä¹ˆä¸ä½¿ç”¨k8sçš„Ingressèµ„æºå‘¢ï¼ŸIngressä¸æ˜¯ä¹Ÿæ˜¯å¯ä»¥æä¾›7å±‚çš„è·¯ç”±å’Œè´Ÿè½½å‡è¡¡å—ï¼Ÿä¸ªäººè®¤ä¸ºIngressä¸»è¦æä¾›äº†k8sé›†ç¾¤å—åŒ—æµé‡çš„ç®¡ç†ï¼ˆIngress Controllerçš„å®ç°ä¸»è¦é‡‡ç”¨Nginxï¼‰ï¼Œè€ŒIstioå¯¹å®¹å™¨æ³¨å…¥çš„proxyæ›´åŠ ç»†ç²’åº¦çš„æ§åˆ¶äº†k8sé›†ç¾¤å†…çš„ä¸œè¥¿æµé‡ï¼ˆproxyçš„å®ç°æ˜¯envoy)ã€‚ ","date":"2022-02-28","objectID":"/posts/22-02-28/:5:0","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Istio"],"content":"Istioå°å®è·µ ","date":"2022-02-28","objectID":"/posts/22-02-28/:6:0","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Istio"],"content":"éƒ¨ç½² ä»¥å®˜æ–¹çš„Bookinfoä¸ºç¤ºä¾‹ï¼Œç•¥è¿‡å®‰è£…æ­¥éª¤ã€‚ Bookinfo\" Bookinfo é¦–å…ˆä¸ºæƒ³è¦å®ç°Istioè¾¹è½¦è‡ªåŠ¨æ³¨å…¥åŠŸèƒ½çš„å‘½åç©ºé—´æ‰“ä¸Šæ ‡ç­¾kubectl label namespace default istio-injection=enabledï¼Œè¿™æ ·åœ¨è¯¥åç§°ç©ºé—´å†…çš„podä¼šè¢«è‡ªåŠ¨æ³¨å…¥proxyã€‚ ç„¶åéƒ¨ç½²Bookinfoåº”ç”¨kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yamlã€‚ ä¹‹åkubectl get pods -n istio-systemå¯ä»¥çœ‹åˆ° ingressã€egresså’Œistiodè¿™ä¸‰ä¸ªpodï¼Œè¿™å°±æ˜¯Istioçš„æ§åˆ¶å¹³é¢ï¼Œè€Œä¸”æ˜¯ä»¥podçš„å½¢å¼å­˜åœ¨çš„ï¼Œå¯è§Istioå’Œk8sçš„ç»“åˆååˆ†ç´§å¯†ï¼ŒIstioå°±æ˜¯é™„åŠ åœ¨k8sä¸Šçš„ã€‚ å…¶ä»–å››ä¸ªpodæ˜¯ä¹‹åéƒ¨ç½²çš„ï¼Œéƒ½æ˜¯ç”¨æ¥Observeï¼Œä»åˆ›å»ºæ—¶é—´å¯ä»¥çœ‹å‡ºã€‚ istio-system namespace\" istio-system namespace å†çœ‹é»˜è®¤çš„åç§°ç©ºé—´ï¼Œæœ‰å…­ä¸ªpodï¼Œä¸”æ¯ä¸ªpodé‡Œæœ‰ä¸¤ä¸ªå®¹å™¨ã€‚ default namespace\" default namespace kubectl describe pod productpage-v1-65b75f6885-qgnzdå¯ä»¥çœ‹åˆ° è¿™ä¸ªproductpage-v1-65b75f6885-qgnzdpodä¸­æœ‰æœ¬èº«çš„productpageå®¹å™¨è¿˜æœ‰istio/proxyv2ï¼Œè¿™ä¸ªå°±æ˜¯è¢«è‡ªåŠ¨æ³¨å…¥çš„proxyï¼Œå°±æ˜¯æµé‡æ§åˆ¶çš„å®é™…æ‰§è¡Œè€…ã€‚ istio/proxyv2\" istio/proxyv2 å½“æˆ‘ä»¬å‘kube-apiserveræäº¤ä¸€ä¸ªç½‘ç»œç­–ç•¥æ—¶ï¼Œæ—¶åˆ»watchç€api-serveråŠ¨å‘çš„Istioæ§åˆ¶å¹³é¢çš„istiodå¾—çŸ¥äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œç„¶ååˆ†å‘åˆ°å„ä¸ªè¢«æ³¨å…¥çš„podçš„proxyå®¹å™¨ï¼ˆenvoyï¼‰ä¸­ï¼Œç„¶åenvoyåŠ è½½ç½‘ç»œç­–ç•¥å¹¶æ‰§è¡Œï¼Œè¿™å°±æ˜¯istioçš„å®ç°æœºåˆ¶ã€‚ è¿›è¡Œå®Œä»¥ä¸Šæ­¥éª¤ä¹‹åå†å¯¹å¤–å¼€æ”¾æœåŠ¡ï¼Œæ·»åŠ ä¸€ç³»åˆ—Observeç»„ä»¶ç­‰ç­‰ä¸€ç³»åˆ—è¿‡ç¨‹ä¸å†èµ˜è¿°ã€‚ ","date":"2022-02-28","objectID":"/posts/22-02-28/:6:1","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Istio"],"content":"æµ‹è¯• åœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œè„šæœ¬æ¨¡æ‹Ÿè¯·æ±‚ while true do curl http://$INGRESS_HOST:$INGRESS_PORT/productpage done ä¹‹åå°±å¯ä»¥åœ¨kialiè¿™ä¸ªè§‚æµ‹å¹³å°ä¸ŠæŸ¥çœ‹æµé‡ kiali\" kiali ","date":"2022-02-28","objectID":"/posts/22-02-28/:6:2","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Istio"],"content":"æ€»ç»“ Istioä¸Kubernetesçš„å¤©ç„¶èåˆä¸”åŸºäºKubernetesæ„å»ºï¼Œè¡¥é½äº†Kubernetesçš„æ²»ç†èƒ½åŠ›ï¼Œæä¾›äº†ç«¯åˆ°ç«¯çš„æœåŠ¡è¿è¡Œæ²»ç†å¹³å°ã€‚è¿™éƒ½ä½¿å¾—Istioã€å¾®æœåŠ¡ã€å®¹å™¨åŠKuberneteså½¢æˆä¸€ä¸ªå®Œç¾çš„é—­ç¯ã€‚ ","date":"2022-02-28","objectID":"/posts/22-02-28/:7:0","tags":["Network"],"title":"æœåŠ¡ç½‘æ ¼ç®€è®°","uri":"/posts/22-02-28/"},{"categories":["Kubernetes"],"content":"Serviceæ˜¯è™šæ‹Ÿçš„ï¼ ","date":"2022-02-10","objectID":"/posts/22-02-10/:0:0","tags":["Network"],"title":"k8s Serviceç®€è®°","uri":"/posts/22-02-10/"},{"categories":["Kubernetes"],"content":"Serviceæ˜¯ä»€ä¹ˆ Podä¸­çš„å®¹å™¨å¯ä»¥é€šè¿‡pauseå®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´å®ç°äº’è®¿ åŒä¸€ä¸ªNodeå†…çš„ä¸åŒPodå¯ä»¥é€šè¿‡Docker0ç½‘æ¡¥å®ç°äº’è®¿ ä¸åŒNodeä¸Šçš„Podå¯ä»¥é€šè¿‡CNIæ’ä»¶ï¼Œä¾‹å¦‚Flannelå®ç°äº’è®¿ é€šè¿‡ä»¥ä¸Šä¸‰ç‚¹ï¼Œä¸€ä¸ªè¦†ç›–äº†k8sé›†ç¾¤çš„æ‰å¹³åŒ–Podäº’è®¿ç½‘ç»œå°±å»ºç«‹èµ·æ¥äº†ï¼Œè¿™ä¸ªOverlay Networkä¸­Podçš„IPåœ°å€ç”±Flannelè¿›è¡Œåˆ’åˆ†ã€‚ ä½†æ˜¯Podçš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼ŒPodçš„æ­»äº¡ã€Podé‡æ–°è¢«æ‹‰èµ·ã€Podçš„æ‰©å®¹éƒ½ä¼šå¯¼è‡´IPåœ°å€çš„å˜åŒ–ã€‚æ‰€ä»¥ä¸èƒ½åœ¨Podå†…ç›´æ¥ä½¿ç”¨IPåœ°å€æ¥è¿›è¡ŒPodé—´çš„è®¿é—®ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŒä¹…çš„é™æ€IPæ¥å®ç°Podé—´çš„è®¿é—®ï¼ŒåŒæ—¶å®ç°è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ã€‚Serviceæ˜¯ä¸€ä¸ªæŠ½è±¡å‡ºæ¥çš„k8sèµ„æºï¼Œæ˜¯ç”±æ¯ä¸ªworker nodeä¸Šçš„kube-proxyç»„ä»¶é€šè¿‡ä¿®æ”¹iptablesï¼ˆiptables modeï¼‰æ¥å®ç°çš„ã€‚ å¯ä»¥å°†Serviceç†è§£ä¸ºä¸€ä¸ªè™šæ‹ŸIPã€‚Serviceçš„IPç©ºé—´åˆæ˜¯ç‹¬ç«‹äºPodçš„IPå’ŒNodeçš„IPï¼Œå¯ä»¥è¢«äººä¸ºæŒ‡å®šï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è®²k8sçš„ç½‘ç»œç©ºé—´è¢«åˆ†ä¸ºä¸‰å±‚ã€‚Podçš„IPæ˜¯ç”±Flannelåˆ’åˆ†çš„ï¼Œä¸€ä¸ªNodeä¸Šä¸€ä¸ªå­ç©ºé—´ï¼›Nodeçš„IPå°±æ˜¯çœŸå®ç‰©ç†ç½‘å¡IPï¼›å†åŠ ä¸ŠServiceçš„IPï¼Œç»„æˆä¸‰å±‚ç½‘ç»œæ¨¡å‹ã€‚ ","date":"2022-02-10","objectID":"/posts/22-02-10/:1:0","tags":["Network"],"title":"k8s Serviceç®€è®°","uri":"/posts/22-02-10/"},{"categories":["Kubernetes"],"content":"Serviceå¦‚ä½•å®ç° Serviceæ˜¯ç”±kube-proxyç»„ä»¶é€šè¿‡ä¿®æ”¹iptableså®ç°çš„ã€‚ wikipedia iptablesæ˜¯è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„åº”ç”¨è½¯ä»¶ï¼Œé€šè¿‡æ§åˆ¶Linuxå†…æ ¸netfilteræ¨¡å—ï¼Œæ¥ç®¡ç†ç½‘ç»œæ•°æ®åŒ…çš„å¤„ç†å’Œè½¬å‘ã€‚ iptables Process Flow\" iptables Process Flow kube-proxyä¸»è¦è®¾ç½®äº†iptablesä¸­çš„natè¡¨ï¼Œé€šè¿‡åœ¨natè¡¨ä¸­è®¾ç½®PREROUTINGå’ŒOUTPUTé“¾æ¥åŠ«æŒç½‘ç»œæ•°æ®ï¼Œè´Ÿè½½å‡è¡¡åœ°å¯¼å‘è‡³Serviceé€‰æ‹©åˆ°çš„Podã€‚ ","date":"2022-02-10","objectID":"/posts/22-02-10/:2:0","tags":["Network"],"title":"k8s Serviceç®€è®°","uri":"/posts/22-02-10/"},{"categories":["Kubernetes"],"content":"ä¸€ä¸ªä¾‹å­ å…·ä½“çš„yamlå°±ä¸å±•ç¤ºäº†ï¼Œæ¸…å•é‡Œæœ‰ä¸€ä¸ªServiceï¼ŒServiceé€‰æ‹©ä¸€ä¸ªPodï¼ŒPodæœ‰8080ã€1985ã€1935ä¸‰ä¸ªç«¯å£ã€‚ æ­¤æ—¶ä½¿ç”¨iptables -t nat -nvLæŸ¥çœ‹natè¡¨ä¸­çš„æ‰€æœ‰é“¾ï¼Œå‘ç°PREROUTINGå’ŒOUTPUTé“¾å‡åœ¨å¤´éƒ¨æ’å…¥äº†ä¸€ä¸ªKUBE-SERVICESã€‚è¿™ä¸ªKUBE-SERVICESé“¾å°±æ˜¯k8sçš„Serviceçš„é—¨æˆ·ï¼ŒServiceå°±æ˜¯é€šè¿‡è¿™ä¸ªé“¾åŠ«æŒæµé‡ï¼Œè¿›è¡ŒDNATå’ŒSNATå®ŒæˆPodé—´çš„äº’è®¿ã€‚ é€šè¿‡kubectl get svcå¯ä»¥æŸ¥çœ‹åˆ°Serviceçš„Cluster IPæ˜¯10.43.69.202ã€‚æ¥ç€å¯ä»¥è·Ÿè¸ªKUBE-SERVICESã€‚å¦‚ä¸‹ KUBE-SERVICESé“¾\" KUBE-SERVICESé“¾ å¯ä»¥çœ‹å‡ºæ‰€æœ‰ç›®çš„åœ°ä¸º10.43.69.202ï¼ˆä¹Ÿå°±æ˜¯Serviceçš„Cluster IPï¼‰ä¸”ç›®çš„ç«¯å£ä¸º1935çš„æ•°æ®åŒ…éƒ½è¢«å¯¼å‘è‡³KUBE-SVC-FQTBCD7TKAEMWX5Mé“¾ï¼Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯Serviceã€‚æ¥ç€è·Ÿè¸ªKUBE-SVC-FQTBCD7TKAEMWX5Mé“¾ã€‚å¦‚ä¸‹ KUBE-SVC-FQTBCD7TKAEMWX5Mé“¾\" KUBE-SVC-FQTBCD7TKAEMWX5Mé“¾ å‘ç°åªæœ‰ä¸€ä¸ªKUBE-SEP-CQBFNZNKSCBZ27C2é“¾ï¼ŒSEPæ„æ€å°±æ˜¯Service End Pointã€‚å› ä¸ºæˆ‘çš„Serviceä¸‹åªæœ‰ä¸€ä¸ªPodæ‰€ä»¥è¿™ä¸ªåœ°æ–¹åªæœ‰ä¸€ä¸ªSEPé“¾ï¼Œå¦‚æœServiceé€‰æ‹©äº†å¤šä¸ªPodçš„è¯ï¼Œè¿™é‡Œåº”è¯¥æœ‰å¯¹åº”çš„endPointæ•°é‡çš„SEPé“¾æ•°ï¼Œå¹¶ä¸”ä½¿ç”¨iptables statistic æ¨¡å—åšround-robinçš„è´Ÿè½½å‡è¡¡ã€‚å…¶å®çœ‹åˆ°è¿™é‡Œå°±å¯ä»¥å‘ç°ä½¿ç”¨iptablesæ¨¡å¼å®ç°Serviceçš„ä¸€äº›ä¸è¶³ï¼Œä¾‹å¦‚ï¼šå¦‚æœåˆ›å»ºäº†è®¸å¤šçš„Serviceï¼Œé‚£ä¹ˆiptablesçš„é“¾æ•°å°±ä¼šå˜å¾—è‚¿èƒ€ï¼Œæ€§èƒ½å°±ä¼šä¸‹é™ã€‚è€Œä¸”iptablesåªæœ‰RRè¿™ä¸€ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä½†ç°å®æ˜¯æˆ‘ä»¬éœ€è¦æ›´å¤šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œäºæ˜¯åœ¨Kubernetes1.14ç‰ˆæœ¬ä»¥åï¼Œå°±é»˜è®¤ä½¿ç”¨ipvsæ¨¡å¼æ¥æ›¿ä»£iptablesæ¨¡å¼ã€‚ ç»§ç»­è·Ÿè¿›KUBE-SEP-CQBFNZNKSCBZ27C2é“¾å¯ä»¥å‘ç° KUBE-SEP-CQBFNZNKSCBZ27C2é“¾\" KUBE-SEP-CQBFNZNKSCBZ27C2é“¾ æœ€åçš„DNATï¼Œä¹Ÿå°±æ˜¯ç›®çš„åœ°å€è½¬æ¢ï¼Œå°†ç›®çš„åœ°å€ä»æœ€åˆçš„è™šæ‹Ÿçš„Service Cluster IPè½¬æ¢è‡³Podçš„IPå’Œç›®çš„ç«¯å£1935ã€‚ NodePortç±»å‹ Serviceå¸¸è§çš„æœ‰ç±»å‹ClusterIPï¼ˆé»˜è®¤ï¼‰ã€NodePortå’ŒLoad Balancerã€‚ åœ¨å¸¸è§çš„æƒ…å†µä¸‹ï¼Œé›†ç¾¤å†…Podé—´çš„äº’è®¿æ˜¯é€šè¿‡è®¾ç½®Service Cluster IPå‘½ä¸­OUTPUTé“¾æœ€ç»ˆè¢«å¯¼å‘Podã€‚ è€Œé›†ç¾¤å¤–çš„è¯·æ±‚è¿›å…¥é›†ç¾¤å†…åˆ™éœ€è¦å°†Serviceè®¾ç½®ä¸ºNodePortï¼ˆç”Ÿäº§ç¯å¢ƒä¸­ä¸è¿™ä¹ˆåšï¼‰ï¼Œkube-proxyä¼šåœ¨æ¯ä¸ªworker nodeä¸Šå¼€å¯ç«¯å£ï¼Œå¤–éƒ¨è¯·æ±‚ä¼šå‘½ä¸­PREROUTINGé“¾æœ€åçš„KUBE-NODEPORTSé“¾ï¼ŒåŒ¹é…è§„åˆ™æ˜¯\"ADDRTYPE match dst-type LOCAL\"ã€‚ä¹‹åä¼šç»§ç»­æ ¹æ®ç«¯å£å¯¼å‘è‡³å¯¹åº”çš„Serviceé“¾ã€‚ ","date":"2022-02-10","objectID":"/posts/22-02-10/:3:0","tags":["Network"],"title":"k8s Serviceç®€è®°","uri":"/posts/22-02-10/"},{"categories":["Kubernetes"],"content":"æ€»ç»“ k8sä¸­çš„Serviceæ˜¯ä¸€ä¸ªæŠ½è±¡å‡ºæ¥çš„åŠŸèƒ½æ¦‚å¿µã€‚ æˆ‘ä»¬å¯ä»¥å°†Serviceæƒ³è±¡æˆä¸ºä¸€ä¸ªæ¥å£ï¼Œå®ƒå®šä¹‰äº†å‡ ä¸ªåŠŸèƒ½ï¼š æœ‰è´¯ç©¿Serviceç”Ÿå‘½å‘¨æœŸçš„å›ºå®šçš„IPå’Œç«¯å£ æœåŠ¡å‘ç° è´Ÿè½½å‡è¡¡ è€Œiptablesæ¨¡å¼æ˜¯å¯¹Serviceçš„ä¸€ä¸ªå…·ä½“å®ç°ï¼š kube-proxyé€šè¿‡è®¾ç½®iptableså¯¹æµé‡è¿›è¡Œè½¬å‘ kube-proxyé€šè¿‡watch api-serverï¼ˆæ˜¯å¦æœ‰Podæ­»äº¡ï¼Ÿé‡æ–°æ‹‰èµ·ï¼Ÿæ‰©å®¹ï¼Ÿï¼‰æ¥æ”¹å†™iptablesè§„åˆ™ åœ¨iptablesçš„SVCé“¾ä¸­å¯¹SEPé“¾è¿›è¡ŒRRçš„è´Ÿè½½å‡è¡¡ iptableså®ç°Serviceå¯ä»¥ç”¨ä¸€å¼ å›¾æ€»ç»“: é€šè¿‡iptableså®ç°Service\" é€šè¿‡iptableså®ç°Service æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯´Serviceæ˜¯é€šè¿‡kube-proxyå’Œiptablesè”åˆå®ç°çš„ï¼Œæ˜¯ä¸ºPodåˆ›é€ å‡ºæ¥çš„å‡è±¡ã€‚ å‚è€ƒï¼š https://www.jianshu.com/p/67744d680286 https://www.cnblogs.com/charlieroro/p/9588019.html ","date":"2022-02-10","objectID":"/posts/22-02-10/:4:0","tags":["Network"],"title":"k8s Serviceç®€è®°","uri":"/posts/22-02-10/"},{"categories":["Kubernetes"],"content":"å¬è¯´kube-prometheuså¼€ç®±å³ç”¨ï¼Ÿ ","date":"2021-08-05","objectID":"/posts/21-08-05/kube-prometheus/:0:0","tags":["Prometheus"],"title":"k8séƒ¨ç½²kube-prometheus","uri":"/posts/21-08-05/kube-prometheus/"},{"categories":["Kubernetes"],"content":"ä½¿ç”¨kindåˆ›å»ºé›†ç¾¤ å®‰è£…å¥½kindåç›´æ¥kind create cluster --config config.yaml --name clusterå¯åŠ¨é›†ç¾¤ï¼Œconfig.yamlå¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªæœ‰ä¸€ä¸ªmasterä¸¤ä¸ªnodeçš„æµ‹è¯•é›†ç¾¤ã€‚æµ‹è¯•å®Œæˆåkind delete cluster --name clusterå³å¯åˆ é™¤é›†ç¾¤ã€‚ # three node (two workers) cluster configkind:ClusterapiVersion:kind.x-k8s.io/v1alpha4nodes:- role:control-plane- role:worker- role:workeråœ¨å°è¯•è¿‡minikubeå’Œkindåè¿˜æ˜¯é€‰æ‹©äº†kindã€‚ ","date":"2021-08-05","objectID":"/posts/21-08-05/kube-prometheus/:1:0","tags":["Prometheus"],"title":"k8séƒ¨ç½²kube-prometheus","uri":"/posts/21-08-05/kube-prometheus/"},{"categories":["Kubernetes"],"content":"éƒ¨ç½²kube-prometheus ä¸€èˆ¬åœ¨é›†ç¾¤ä¸­éƒ¨ç½²Prometheusæœ‰ä¸‰ç§æ–¹æ³•ï¼šPrometheus Operatorã€kube-prometheus å’Œ community helm chartã€‚ éƒ¨ç½²æ–¹å¼æ¯”è¾ƒ Prometheus Operator The Prometheus Operator uses Kubernetes custom resources to simplify the deployment and configuration of Prometheus, Alertmanager, and related monitoring components. kube-prometheus kube-prometheus provides example configurations for a complete cluster monitoring stack based on Prometheus and the Prometheus Operator. This includes deployment of multiple Prometheus and Alertmanager instances, metrics exporters such as the node_exporter for gathering node metrics, scrape target configuration linking Prometheus to various metrics endpoints, and example alerting rules for notification of potential issues in the cluster. helm chart The prometheus-community/kube-prometheus-stack helm chart provides a similar feature set to kube-prometheus. This chart is maintained by the Prometheus community. For more information, please see the chartâ€™s readme kube-prometheusæä¾›äº†è®¸å¤šå¼€ç®±å³ç”¨çš„é…ç½®ï¼Œä¾‹å¦‚Alertmanagerã€node-exporterä»¥åŠGrafana dashboardsã€‚ å°†kube-prometheusé¡¹ç›®cloneè‡³æœ¬åœ°ï¼Œç„¶åæ‰§è¡Œ: # Create the namespace and CRDs, and then wait for them to be available before creating the remaining resources kubectl create -f manifests/setup until kubectl get servicemonitors --all-namespaces ; do date; sleep 1; echo \"\"; done kubectl create -f manifests/ ç”±äºåˆ›å»ºé•œåƒéœ€è¦æ‹‰å–çš„é•œåƒæ‰˜ç®¡åœ¨quay.ioï¼Œä¼šå‡ºç°ImagePullBackOffé”™è¯¯ï¼š ImagePullBackOff\" ImagePullBackOff k describe pods -n monitoring prometheus-operator-75d9b475d9-f29g8æ£€æŸ¥ä¸€ä¸‹ï¼Œæ˜¯ quay.io/brancz/kube-rbac-proxy:v0.11.0 quay.io/prometheus-operator/prometheus-operator:v0.49.0 ä¸¤ä¸ªé•œåƒæ‹‰å–å¤±è´¥ï¼Œè¿™æ—¶å€ŸåŠ©é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡è¿›è¡Œæ‹‰å–ã€‚ é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡æ„å»ºé•œåƒæ­¥éª¤ åˆ›å»ºGitHub repoï¼Œè·¯å¾„æ ¼å¼ä¸ºï¼šimage-name/tag/Dockerfile åœ¨é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ä¸­åˆ›å»ºä»“åº“image-name é€‰æ‹©ä»£ç æºä¸ºGitHub repoï¼Œé€‰æ‹©æµ·å¤–æ„å»º è¿›å…¥ä»“åº“ï¼Œæ·»åŠ æ„å»ºè§„åˆ™ï¼Œç«‹å³æ„å»º æ„å»ºå®Œæˆåç™»å½•åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼š docker login --username=xxx registry.cn-hangzhou.aliyuncs.com æ‹‰å–æ„å»ºå¥½çš„é•œåƒï¼šdocker pull registry.cn-hangzhou.aliyuncs.com/chengleqi/prometheus-operator:v0.49.0 è¿›è¡Œretagï¼šdocker tag registry.cn-hangzhou.aliyuncs.com/chengleqi/prometheus-operator:v0.49.0 quay.io/prometheus-operator/prometheus-operator:v0.49.0 åˆ é™¤ä¹‹å‰çš„é•œåƒï¼šdocker rmi registry.cn-hangzhou.aliyuncs.com/chengleqi/prometheus-operator:v0.49.0 brancz/kube-rbac-proxy:v0.11.0ä¹Ÿé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œæ­¤æ—¶å°±æœ‰äº†kube-operatoræ‰€éœ€çš„é•œåƒã€‚ ä½¿ç”¨kind load docker-image quay.io/brancz/kube-rbac-proxy:v0.11.0 quay.io/prometheus-operator/prometheus-operator:v0.49.0 --name clusterå°†é•œåƒåŠ è½½è¿›kindé›†ç¾¤ï¼Œç„¶åprometheus-operator-75d9b475d9-f29g8è¿™ä¸ªpodå°±æ­£å¸¸è¿è¡Œäº†ã€‚ kube-operator-podå¤„äºRunningçŠ¶æ€\" kube-operator-podå¤„äºRunningçŠ¶æ€ è‹¥è¿˜æœ‰é•œåƒæŠ¥é”™ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰podéƒ½å¤„äºRunningçŠ¶æ€ï¼Œåˆ°æ­¤kube-prometheuséƒ¨ç½²æˆåŠŸã€‚ ","date":"2021-08-05","objectID":"/posts/21-08-05/kube-prometheus/:2:0","tags":["Prometheus"],"title":"k8séƒ¨ç½²kube-prometheus","uri":"/posts/21-08-05/kube-prometheus/"},{"categories":["Kubernetes"],"content":"æµ‹è¯•kube-prometheus ","date":"2021-08-05","objectID":"/posts/21-08-05/kube-prometheus/:3:0","tags":["Prometheus"],"title":"k8séƒ¨ç½²kube-prometheus","uri":"/posts/21-08-05/kube-prometheus/"},{"categories":["Kubernetes"],"content":"Prometheus è¿™é‡Œè®¾ç½®serviceçš„ç«¯å£è½¬å‘ï¼Œæ¥ç€å°±èƒ½è¿›å…¥Prometheusçš„UIå°è¯•PromQLäº†ã€‚ kubectl --namespace monitoring port-forward svc/prometheus-k8s 9090 info ä¸€æœ¬Prometheusçš„ä¹¦ ","date":"2021-08-05","objectID":"/posts/21-08-05/kube-prometheus/:3:1","tags":["Prometheus"],"title":"k8séƒ¨ç½²kube-prometheus","uri":"/posts/21-08-05/kube-prometheus/"},{"categories":["Kubernetes"],"content":"grafana åŒæ ·è®¾ç½®ç«¯å£è½¬å‘ kubectl --namespace monitoring port-forward svc/grafana 3000 tip ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯admin ä¹‹åå°±å¯ä»¥å°è¯•è‡ªå¸¦çš„é¢æ¿äº†(ä¾‹å¦‚node-exporter)ï¼š grafana node-exporter\" grafana node-exporter Grafanaä¸ä»…å¯ä»¥å¯¹æ¥Prometheusï¼Œè¿˜å¯ä»¥å¯¹æ¥zabbixç­‰å¾ˆå¤šæ•°æ®æºï¼Œæ˜¯ä¸€ä¸ªéå¸¸æ¼‚äº®å’Œå¥½ç”¨çš„å¯è§†åŒ–å·¥å…·ã€‚ info è¿˜æœ‰ä¸€ä¸ªè‡ªç§°Kubernetes IDEçš„å·¥å…·Lensï¼Œæˆ‘å°è¯•äº†ä¸€ä¸‹ï¼Œä¹Ÿå¾ˆå¥½ç”¨ã€‚ ","date":"2021-08-05","objectID":"/posts/21-08-05/kube-prometheus/:3:2","tags":["Prometheus"],"title":"k8séƒ¨ç½²kube-prometheus","uri":"/posts/21-08-05/kube-prometheus/"},{"categories":null,"content":"About Me? âš½ å¸Œæœ›æœ—å°¼å…‹ä¸‹è¯¾çš„æ›¼è”çƒè¿· || FIFAè¾¹è·¯ä¼ ä¸­é€‰æ‰‹ || é˜²å®ˆåå‡»æˆ˜æœ¯æ‹¥è¶¸ || å°åŒºçº§åè…° ğŸ“ åˆä¸­é€€å½¹é€‰æ‰‹ ğŸµ ç‹è‹¥ç³ || Nujabes || John Coltrane || Slipknot || Bob Marley || Blur || ä¸€äº›å—ç¾æ°‘æ­Œ ğŸ¬ gakki || åºƒæœ« æ¶¼å­ || æº€å³¶ã²ã‹ã‚Š ğŸ¾ PGPæŒ‡çº¹ : 07B8 C554 5047 05F5 53A8 0A9D 51B3 76E1 190C B0D7 ğŸºâ˜• and... FUCK GFW ","date":"2021-08-03","objectID":"/about/:1:0","tags":null,"title":"About","uri":"/about/"},{"categories":null,"content":"Website Timeline NAME READY STATUS RESTARTS ROLES this is my etcd. 1/1 Running 0 control-panel ","date":"2021-08-03","objectID":"/about/:2:0","tags":null,"title":"About","uri":"/about/"},{"categories":null,"content":"Some Configurations init.vim \" ##########åŸºæœ¬é…ç½®########## set nu set clipboard=unnamedplus set termguicolors syntax enable set tabstop=4 set softtabstop=4 set shiftwidth=4 set noexpandtab set autoindent set cursorline set relativenumber \" ##########æŒ‰é”®æ˜ å°„########## :let mapleader=\",\" \" ##########æ’ä»¶é…ç½®########## call plug#begin() Plug 'arcticicestudio/nord-vim' Plug 'mhinz/vim-startify' Plug 'scrooloose/nerdtree' Plug 'junegunn/fzf', { 'do': { -\u003e fzf#install() } } Plug 'fatih/vim-go', { 'do': ':GoUpdateBinaries' } call plug#end() \" NERDTree nnoremap \u003cleader\u003en :NERDTree\u003cCR\u003e nnoremap \u003cleader\u003et :NERDTreeToggle\u003cCR\u003e nnoremap \u003cleader\u003ef :NERDTreeFind\u003cCR\u003e \" vim-go \" https://github.com/arcticicestudio/nord-vim/issues/203#issuecomment-620800009 let g:go_highlight_structs = 1 let g:go_highlight_methods = 1 let g:go_highlight_functions = 1 \" diff from the issue is ADD THIS LINE let g:go_highlight_function_calls = 1 let g:go_highlight_function_parameters = 1 let g:go_highlight_operators = 1 let g:go_highlight_types = 1 let g:go_highlight_fields = 1 let g:go_highlight_build_constraints = 1 let g:go_highlight_generate_tags = 1 let g:go_highlight_format_strings = 1 let g:go_highlight_variable_declarations = 1 let g:go_highlight_variable_assignments = 1 let g:go_auto_type_info =1 let g:go_fmt_autosave = 1 let g:go_mod_fmt_autosave = 1 let g:go_gopls_enabled = 1 \" ##########ä¸»é¢˜é…ç½®########## let g:nord_uniform_status_lines = 1 colorscheme nord ","date":"2021-08-03","objectID":"/about/:3:0","tags":null,"title":"About","uri":"/about/"},{"categories":["Hugo"],"content":"åšå®¢è¿˜æ˜¯ç®€æ´ä¸€ç‚¹æ¯”è¾ƒå¥½ï¼Ÿ ","date":"2021-08-01","objectID":"/posts/21-08-01/hugo/:0:0","tags":["Docker","CI/CD"],"title":"åšå®¢æ­å»ºç®€è®°","uri":"/posts/21-08-01/hugo/"},{"categories":["Hugo"],"content":"æ•ˆæœ git commit + pushå³å¯ã€‚ ","date":"2021-08-01","objectID":"/posts/21-08-01/hugo/:1:0","tags":["Docker","CI/CD"],"title":"åšå®¢æ­å»ºç®€è®°","uri":"/posts/21-08-01/hugo/"},{"categories":["Hugo"],"content":"workflow å¦‚ä¸‹å›¾: workflow(ç‚¹å‡»å›¾ç‰‡è·³è½¬è‡³Live Editor) ä¸Šå›¾æ˜¯ç”¨mermaidç”»çš„ï¼Œflowchartæ˜¯mermaidé«˜ç‰ˆæœ¬çš„featureï¼Œåœ¨æˆ‘ä½¿ç”¨Feelitä¸»é¢˜shortcodeçš„æ—¶å€™è¿˜æ²¡æœ‰å¾—åˆ°æ”¯æŒï¼Œæäº†ä¸ªissueï¼Œåœ¨è¿™æ¬¡æ›´æ–°ä¸­å¾—åˆ°äº†æ”¯æŒã€‚ mermaid shortcodeåœ¨æ‰‹æœºæµè§ˆå™¨ä¸­æ²¡æœ‰å¾—åˆ°å¾ˆå¥½çš„æ”¯æŒï¼Œæ¢å›figure shortcodeã€‚(2021å¹´ 08æœˆ 04æ—¥ æ˜ŸæœŸä¸‰ 15:30:15 CST) ","date":"2021-08-01","objectID":"/posts/21-08-01/hugo/:2:0","tags":["Docker","CI/CD"],"title":"åšå®¢æ­å»ºç®€è®°","uri":"/posts/21-08-01/hugo/"},{"categories":["Hugo"],"content":"ä½¿ç”¨Dockerè¿›è¡Œæœ¬åœ°é¢„è§ˆ å‚è€ƒäº†jojomi/docker-hugoé‡å†™äº†Dockerfileå’Œæ„å»ºé•œåƒå¹¶ä¸”å¯åŠ¨å®¹å™¨çš„è„šæœ¬chengleqi/docker-hugoã€‚ é•œåƒçš„README åœ¨æµè§ˆå™¨ä¸­ä¸‹è½½æœ€æ–°ç‰ˆhugo binary(extendç‰ˆæœ¬) å°†ä¸‹è½½å¥½çš„hugo binaryæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½• æ‰§è¡Œ./build_and_start_hugo.sh æ„å»ºé•œåƒå¹¶è¿è¡Œå®¹å™¨ æ‰“å¼€æµè§ˆå™¨ localhost:1313 æ³¨æ„ åœ¨docker runçš„æ—¶å€™æŒ‚è½½äº†blogç›®å½•ç”¨äºhugo serverï¼Œå¹¶æ·»åŠ äº†--rmå‚æ•°ï¼Œé€€å‡ºå®¹å™¨åç›´æ¥åˆ é™¤å®¹å™¨ã€‚ ","date":"2021-08-01","objectID":"/posts/21-08-01/hugo/:2:1","tags":["Docker","CI/CD"],"title":"åšå®¢æ­å»ºç®€è®°","uri":"/posts/21-08-01/hugo/"},{"categories":["Hugo"],"content":"ä½¿ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºå¹¶éƒ¨ç½² æ­¤å¤„å‚è€ƒäº†Arnab Kumar Shilçš„æ–‡ç« ã€‚é…ç½®äº†GitHub Actionsçš„æµæ°´çº¿ã€‚è„šæœ¬å¦‚ä¸‹: name:github pageson:push:branches:- main # Set a branch to deploypull_request:jobs:deploy:runs-on:ubuntu-20.04steps:- uses:actions/checkout@v2with:submodules:true# Fetch Hugo themes (true OR recursive)fetch-depth:0# Fetch all history for .GitInfo and .Lastmod- name:Setup Hugouses:peaceiris/actions-hugo@v2with:hugo-version:'latest'extended:true- name:Buildrun:hugo --minify- name:Deployuses:peaceiris/actions-gh-pages@v3if:github.ref == 'refs/heads/main'with:personal_token:${{ secrets.ACTION_ACCESS_TOKEN }}external_repository:chengleqi/chengleqi.github.iopublish_branch:mainpublish_dir:./publiccname:chengleqi.comè¿™ä¸ªè„šæœ¬ä½¿ç”¨äº†peaceiris/actions-hugo@v2å’Œpeaceiris/actions-gh-pages@v3ä¸¤ä¸ªactionåˆ†åˆ«ç”¨äºè®¾ç½®hugoç¯å¢ƒä»¥åŠæ¨é€è‡³gh-pagesã€‚ æŠ€å·§ å­˜å‚¨blogæºæ–‡ä»¶çš„repoè®¿é—®github.io repoéœ€è¦è®¾ç½®personal_token: ${{ secrets.ACTION_ACCESS_TOKEN }} åœ¨Deploy jobä¸­éœ€è¦æŒ‡å®šCNAMEï¼Œä¼šè‡ªåŠ¨ç”ŸæˆCNAMEæ–‡ä»¶ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ·»åŠ ï¼Œå‚è€ƒHugoå®˜ç½‘ã€‚ ","date":"2021-08-01","objectID":"/posts/21-08-01/hugo/:2:2","tags":["Docker","CI/CD"],"title":"åšå®¢æ­å»ºç®€è®°","uri":"/posts/21-08-01/hugo/"},{"categories":["Hugo"],"content":"å¯ç”¨algoliaæœç´¢ å› ä¸ºalgoliaéœ€è¦ä¸Šä¼ ç´¢å¼•æ–‡ä»¶ï¼Œä¸»é¢˜çš„ä½œè€…æ¨èäº†ä¸€æ¬¾Algolia Atomicæ’ä»¶ç”¨æ¥å®Œæˆè‡ªåŠ¨åŒ–ä¸Šä¼ ã€‚ è¿™æ¬¾æ’ä»¶éœ€è¦nodeå’Œnpmï¼Œæˆ‘å‚è€ƒäº†è¿™ç¯‡æ–‡ç« ï¼Œç›´æ¥åœ¨GitHub Actionsåˆ†é…çš„VPSä¸­é…ç½®ä¸æˆåŠŸã€‚ äºæ˜¯æ‰¾åˆ°äº†è¿™ä¸ªæ–¹æ¡ˆï¼Œä½œè€…å°†atomic-algoliaå°è£…è¿›dockerå®¹å™¨ä¸­ï¼Œå¯åŠ¨ç«‹å³æ‰§è¡Œatomic-alogliaã€‚å°†dockerå¯åŠ¨å‘½ä»¤é™„åŠ åˆ°pipelineè„šæœ¬ä¸­ï¼Œå†æ¬¡æ¨é€ï¼Œä¸€æ¬¡æˆåŠŸï¼Œåªæ˜¯å¤šå‡ºäº†æ‹‰å–é•œåƒçš„æ—¶é—´ã€‚æˆ‘å·²å°†é•œåƒåŒæ­¥è‡³Docker Hubè¿›è¡Œè§£è€¦ã€‚ ","date":"2021-08-01","objectID":"/posts/21-08-01/hugo/:2:3","tags":["Docker","CI/CD"],"title":"åšå®¢æ­å»ºç®€è®°","uri":"/posts/21-08-01/hugo/"}]